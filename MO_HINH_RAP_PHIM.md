# MÃ” HÃŒNH Ráº P PHIM VÃ€ CHá»¨C NÄ‚NG NGHIá»†P Vá»¤

## ğŸ“‹ GIá»šI THIá»†U

TÃ i liá»‡u nÃ y mÃ´ táº£ chi tiáº¿t mÃ´ hÃ¬nh ráº¡p phim cá»§a há»‡ thá»‘ng Ä‘áº·t vÃ© xem phim **QuickShow**, bao gá»“m cáº¥u trÃºc phÃ²ng chiáº¿u, quáº£n lÃ½ gháº¿ ngá»“i, vÃ  cÃ¡c quy trÃ¬nh nghiá»‡p vá»¥.

---

## ğŸ¯ 1. Má»¤C TIÃŠU

### 1.1. Má»¥c tiÃªu tá»•ng quan

XÃ¢y dá»±ng há»‡ thá»‘ng Ä‘áº·t vÃ© xem phim trá»±c tuyáº¿n **QuickShow** nháº±m:

- **Sá»‘ hÃ³a quy trÃ¬nh Ä‘áº·t vÃ©**: Thay tháº¿ viá»‡c Ä‘áº·t vÃ© thá»§ cÃ´ng táº¡i quáº§y báº±ng há»‡ thá»‘ng Ä‘áº·t vÃ© trá»±c tuyáº¿n hiá»‡n Ä‘áº¡i
- **Tá»‘i Æ°u tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng**: Cho phÃ©p khÃ¡ch hÃ ng xem lá»‹ch chiáº¿u, chá»n gháº¿ vÃ  thanh toÃ¡n má»i lÃºc má»i nÆ¡i
- **Tá»± Ä‘á»™ng hÃ³a váº­n hÃ nh**: Giáº£m thiá»ƒu cÃ´ng viá»‡c thá»§ cÃ´ng cho nhÃ¢n viÃªn, tá»± Ä‘á»™ng hÃ³a cÃ¡c tÃ¡c vá»¥ nhÆ° gá»­i email, quáº£n lÃ½ gháº¿, há»§y booking
- **Quáº£n lÃ½ táº­p trung**: Cung cáº¥p cÃ´ng cá»¥ quáº£n trá»‹ toÃ n diá»‡n cho admin vá» suáº¥t chiáº¿u, Ä‘áº·t vÃ© vÃ  doanh thu

### 1.2. Má»¥c tiÃªu cá»¥ thá»ƒ

#### Vá» nghiá»‡p vá»¥:
- âœ… Cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘áº·t vÃ© online 24/7
- âœ… TÃ­ch há»£p thanh toÃ¡n trá»±c tuyáº¿n an toÃ n qua Stripe
- âœ… Tá»± Ä‘á»™ng gá»­i email xÃ¡c nháº­n vÃ  nháº¯c nhá»Ÿ
- âœ… Quáº£n lÃ½ gháº¿ ngá»“i realtime, trÃ¡nh Ä‘áº·t trÃ¹ng
- âœ… Cung cáº¥p thÃ´ng tin phim phong phÃº tá»« TMDB
- âœ… Cho phÃ©p admin quáº£n lÃ½ suáº¥t chiáº¿u dá»… dÃ ng

#### Vá» ká»¹ thuáº­t:
- âœ… XÃ¢y dá»±ng kiáº¿n trÃºc fullstack hiá»‡n Ä‘áº¡i (React + Node.js + MongoDB)
- âœ… TÃ­ch há»£p cÃ¡c dá»‹ch vá»¥ bÃªn thá»© ba (Clerk, Stripe, Inngest, Brevo, TMDB)
- âœ… Ãp dá»¥ng background jobs Ä‘á»ƒ xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™
- âœ… Äáº£m báº£o báº£o máº­t vá»›i JWT authentication
- âœ… Responsive design cho má»i thiáº¿t bá»‹

#### Vá» ngÆ°á»i dÃ¹ng:
- âœ… Giao diá»‡n thÃ¢n thiá»‡n, dá»… sá»­ dá»¥ng
- âœ… Quy trÃ¬nh Ä‘áº·t vÃ© nhanh chÃ³ng (< 3 phÃºt)
- âœ… ThÃ´ng bÃ¡o rÃµ rÃ ng vá» tráº¡ng thÃ¡i booking
- âœ… Quáº£n lÃ½ lá»‹ch sá»­ Ä‘áº·t vÃ© cÃ¡ nhÃ¢n

---

## ğŸ“ 2. PHáº M VI

### 2.1. Trong pháº¡m vi dá»± Ã¡n

#### Chá»©c nÄƒng Ä‘Ã£ triá»ƒn khai:

**NgÆ°á»i dÃ¹ng:**
- âœ… Xem danh sÃ¡ch phim Ä‘ang chiáº¿u
- âœ… Xem chi tiáº¿t phim (thÃ´ng tin, diá»…n viÃªn, trailer)
- âœ… Xem lá»‹ch chiáº¿u theo ngÃ y vÃ  giá»
- âœ… Äáº·t vÃ© vá»›i sÆ¡ Ä‘á»“ gháº¿ trá»±c quan
- âœ… Thanh toÃ¡n trá»±c tuyáº¿n qua Stripe
- âœ… Xem lá»‹ch sá»­ Ä‘áº·t vÃ©
- âœ… Quáº£n lÃ½ danh sÃ¡ch phim yÃªu thÃ­ch
- âœ… Nháº­n email xÃ¡c nháº­n sau khi Ä‘áº·t vÃ©
- âœ… Nháº­n email nháº¯c nhá»Ÿ trÆ°á»›c 8 giá» chiáº¿u

**Admin:**
- âœ… Dashboard thá»‘ng kÃª tá»•ng quan
- âœ… ThÃªm suáº¥t chiáº¿u tá»« danh sÃ¡ch phim TMDB
- âœ… Xem danh sÃ¡ch táº¥t cáº£ suáº¥t chiáº¿u
- âœ… Xem danh sÃ¡ch táº¥t cáº£ booking
- âœ… Gá»­i thÃ´ng bÃ¡o phim má»›i cho users

**Há»‡ thá»‘ng:**
- âœ… Tá»± Ä‘á»™ng Ä‘á»“ng bá»™ users tá»« Clerk
- âœ… Tá»± Ä‘á»™ng há»§y booking chÆ°a thanh toÃ¡n sau 10 phÃºt
- âœ… Tá»± Ä‘á»™ng giáº£i phÃ³ng gháº¿ khi booking bá»‹ há»§y
- âœ… Xá»­ lÃ½ webhook tá»« Stripe
- âœ… Background jobs vá»›i Inngest

#### Giá»›i háº¡n hiá»‡n táº¡i:

- ğŸ”´ **1 phÃ²ng chiáº¿u duy nháº¥t** - KhÃ´ng há»— trá»£ nhiá»u phÃ²ng/ráº¡p
- ğŸ”´ **SÆ¡ Ä‘á»“ gháº¿ cá»‘ Ä‘á»‹nh** - 10 hÃ ng x 9 gháº¿, khÃ´ng thá»ƒ thay Ä‘á»•i
- ğŸ”´ **KhÃ´ng phÃ¢n loáº¡i gháº¿** - Táº¥t cáº£ gháº¿ Ä‘á»u cÃ¹ng giÃ¡ (khÃ´ng cÃ³ VIP, Ä‘Ã´i, v.v.)
- ğŸ”´ **KhÃ´ng quáº£n lÃ½ Ä‘á»“ Äƒn/combo** - Chá»‰ bÃ¡n vÃ©
- ğŸ”´ **KhÃ´ng cÃ³ chÆ°Æ¡ng trÃ¬nh khuyáº¿n mÃ£i** - ChÆ°a cÃ³ voucher/discount
- ğŸ”´ **KhÃ´ng cÃ³ review/rating** - User khÃ´ng thá»ƒ Ä‘Ã¡nh giÃ¡ phim

### 2.2. NgoÃ i pháº¡m vi dá»± Ã¡n

CÃ¡c tÃ­nh nÄƒng **KHÃ”NG** cÃ³ trong phiÃªn báº£n hiá»‡n táº¡i:

âŒ Quáº£n lÃ½ nhiá»u ráº¡p/chi nhÃ¡nh  
âŒ Quáº£n lÃ½ nhiá»u phÃ²ng chiáº¿u  
âŒ SÆ¡ Ä‘á»“ gháº¿ linh hoáº¡t/tÃ¹y chá»‰nh  
âŒ PhÃ¢n loáº¡i gháº¿ (VIP, thÆ°á»ng, Ä‘Ã´i)  
âŒ Äáº·t Ä‘á»“ Äƒn/combo  
âŒ ChÆ°Æ¡ng trÃ¬nh khuyáº¿n mÃ£i/voucher  
âŒ Äiá»ƒm thÆ°á»Ÿng/loyalty program  
âŒ Review vÃ  rating phim  
âŒ Social features (share, comment)  
âŒ Mobile app (iOS/Android)  
âŒ Thanh toÃ¡n offline (tiá»n máº·t táº¡i quáº§y)  
âŒ In vÃ© tá»± Ä‘á»™ng  
âŒ QR code check-in  
âŒ PhÃ¢n tÃ­ch hÃ nh vi ngÆ°á»i dÃ¹ng  
âŒ A/B testing  

---

## ğŸ‘¥ 3. Äá»I TÆ¯á»¢NG Sá»¬ Dá»¤NG

### 3.1. NgÆ°á»i dÃ¹ng cuá»‘i (End Users)

**Äáº·c Ä‘iá»ƒm:**
- KhÃ¡ch hÃ ng muá»‘n Ä‘áº·t vÃ© xem phim trá»±c tuyáº¿n
- Äá»™ tuá»•i: 16-45 tuá»•i (chá»§ yáº¿u Gen Z vÃ  Millennials)
- Quen thuá»™c vá»›i cÃ´ng nghá»‡, thÃ­ch mua sáº¯m online
- Sá»­ dá»¥ng cáº£ desktop vÃ  mobile

**Nhu cáº§u:**
- Xem thÃ´ng tin phim nhanh chÃ³ng
- Äáº·t vÃ© thuáº­n tiá»‡n, khÃ´ng cáº§n Ä‘áº¿n quáº§y
- Chá»n Ä‘Æ°á»£c gháº¿ ngá»“i yÃªu thÃ­ch
- Thanh toÃ¡n an toÃ n, nhanh gá»n
- Nháº­n thÃ´ng bÃ¡o rÃµ rÃ ng vá» booking

**Quyá»n háº¡n:**
- Xem danh sÃ¡ch phim
- Xem chi tiáº¿t phim vÃ  lá»‹ch chiáº¿u
- Äáº·t vÃ© (sau khi Ä‘Äƒng nháº­p)
- Thanh toÃ¡n online
- Xem lá»‹ch sá»­ booking
- Quáº£n lÃ½ danh sÃ¡ch yÃªu thÃ­ch

### 3.2. Quáº£n trá»‹ viÃªn (Admin)

**Äáº·c Ä‘iá»ƒm:**
- NhÃ¢n viÃªn quáº£n lÃ½ ráº¡p phim
- CÃ³ kiáº¿n thá»©c cÆ¡ báº£n vá» mÃ¡y tÃ­nh
- Cáº§n cÃ´ng cá»¥ quáº£n lÃ½ Ä‘Æ¡n giáº£n, hiá»‡u quáº£

**Nhu cáº§u:**
- ThÃªm/quáº£n lÃ½ suáº¥t chiáº¿u nhanh chÃ³ng
- Xem thá»‘ng kÃª doanh thu, booking
- Theo dÃµi tÃ¬nh hÃ¬nh Ä‘áº·t vÃ©
- Gá»­i thÃ´ng bÃ¡o Ä‘áº¿n khÃ¡ch hÃ ng

**Quyá»n háº¡n:**
- Táº¥t cáº£ quyá»n cá»§a User
- Truy cáº­p Admin Panel
- Xem Dashboard thá»‘ng kÃª
- ThÃªm suáº¥t chiáº¿u má»›i
- Xem táº¥t cáº£ shows vÃ  bookings
- Gá»­i email thÃ´ng bÃ¡o

### 3.3. Há»‡ thá»‘ng (System)

**Background Jobs:**
- Äá»“ng bá»™ dá»¯ liá»‡u tá»« Clerk
- Tá»± Ä‘á»™ng há»§y booking chÆ°a thanh toÃ¡n
- Gá»­i email xÃ¡c nháº­n vÃ  nháº¯c nhá»Ÿ
- Scheduled tasks (cron jobs)

---

## ğŸ—ï¸ 4. Tá»”NG QUAN Há»† THá»NG

### 4.1. Kiáº¿n trÃºc tá»•ng quan

```mermaid
graph TB
    subgraph User_Layer[Lá»›p ngÆ°á»i dÃ¹ng]
        Browser[Web Browser]
        Mobile[Mobile Browser]
    end

    subgraph Presentation_Layer[Lá»›p giao diá»‡n - Frontend]
        React[React App]
        Router[React Router]
        Context[Context API]
        UI[Tailwind CSS]
    end

    subgraph API_Layer[Lá»›p API - Backend]
        Express[Express Server]
        Routes[API Routes]
        Controllers[Controllers]
        Middleware[Auth Middleware]
    end

    subgraph Data_Layer[Lá»›p dá»¯ liá»‡u]
        Mongoose[Mongoose ODM]
        MongoDB[(MongoDB Database)]
    end

    subgraph External_Services[Dá»‹ch vá»¥ bÃªn ngoÃ i]
        Clerk[Clerk - Auth]
        TMDB[TMDB - Movie Data]
        Stripe[Stripe - Payment]
        Inngest[Inngest - Jobs]
        Brevo[Brevo - Email]
    end

    Browser --> React
    Mobile --> React
    React --> Router
    React --> Context
    React --> UI
    React -->|HTTP/HTTPS| Express

    Express --> Routes
    Routes --> Middleware
    Middleware --> Controllers
    Controllers --> Mongoose
    Mongoose --> MongoDB

    Controllers --> Clerk
    Controllers --> TMDB
    Controllers --> Stripe
    Controllers --> Inngest
    Inngest --> Brevo

    Clerk -->|Webhooks| Inngest
    Stripe -->|Webhooks| Express
```

### 4.2. Tech Stack

#### Frontend:
- **Framework**: React 18 + Vite
- **Routing**: React Router v6
- **Styling**: Tailwind CSS
- **State Management**: Context API
- **HTTP Client**: Axios
- **Icons**: Lucide React
- **Notifications**: React Hot Toast
- **Auth**: Clerk React SDK

#### Backend:
- **Runtime**: Node.js
- **Framework**: Express.js
- **Database**: MongoDB
- **ODM**: Mongoose
- **Auth**: Clerk Express SDK
- **Payment**: Stripe SDK
- **Jobs**: Inngest SDK
- **Email**: Brevo API (HTTP)

#### External Services:
- **Clerk**: Authentication & User Management
- **TMDB**: Movie Database API
- **Stripe**: Payment Processing
- **Inngest**: Background Jobs & Event-Driven Workflows
- **Brevo**: Transactional Email Service

#### Deployment:
- **Frontend**: Vercel
- **Backend**: Railway
- **Database**: MongoDB Atlas

### 4.3. Luá»“ng dá»¯ liá»‡u chÃ­nh

```mermaid
flowchart LR
    User[NgÆ°á»i dÃ¹ng] -->|1. Request| Frontend[React Frontend]
    Frontend -->|2. API Call| Backend[Express Backend]
    Backend -->|3. Query| DB[(MongoDB)]
    DB -->|4. Data| Backend
    Backend -->|5. Response| Frontend
    Frontend -->|6. Render| User

    Backend -.->|Auth| Clerk[Clerk]
    Backend -.->|Movie Info| TMDB[TMDB]
    Backend -.->|Payment| Stripe[Stripe]
    Backend -.->|Events| Inngest[Inngest]
    Inngest -.->|Email| Brevo[Brevo]
```

### 4.4. Database Schema

```mermaid
erDiagram
    USER ||--o{ BOOKING : creates
    MOVIE ||--o{ SHOW : has
    SHOW ||--o{ BOOKING : contains

    USER {
        string _id PK
        string name
        string email UK
        string image
    }

    MOVIE {
        string _id PK
        string title
        string overview
        string poster_path
        string backdrop_path
        array genres
        array casts
        number vote_average
        number runtime
    }

    SHOW {
        objectId _id PK
        string movie FK
        date showDateTime
        number showPrice
        object occupiedSeats
    }

    BOOKING {
        objectId _id PK
        string user FK
        string show FK
        number amount
        array bookedSeats
        boolean ispaid
        string paymentLink
    }
```

---

## âš™ï¸ 5. CHá»¨C NÄ‚NG CHÃNH

### 5.1. Module XÃ¡c thá»±c (Authentication)

**MÃ´ táº£:** Quáº£n lÃ½ Ä‘Äƒng nháº­p, Ä‘Äƒng kÃ½ vÃ  phÃ¢n quyá»n ngÆ°á»i dÃ¹ng

**Chá»©c nÄƒng:**
- ÄÄƒng kÃ½ tÃ i khoáº£n má»›i
- ÄÄƒng nháº­p (email/password, Google, v.v.)
- ÄÄƒng xuáº¥t
- Quáº£n lÃ½ session
- PhÃ¢n quyá»n (User/Admin)

**CÃ´ng nghá»‡:** Clerk Authentication

**Äá»‘i tÆ°á»£ng:** Táº¥t cáº£ ngÆ°á»i dÃ¹ng

### 5.2. Module Quáº£n lÃ½ Phim (Movies)

**MÃ´ táº£:** Hiá»ƒn thá»‹ thÃ´ng tin phim Ä‘ang chiáº¿u

**Chá»©c nÄƒng:**
- Xem danh sÃ¡ch phim Ä‘ang cÃ³ suáº¥t chiáº¿u
- Xem chi tiáº¿t phim (poster, overview, genres, casts, rating)
- TÃ¬m kiáº¿m vÃ  lá»c phim
- ThÃªm/xÃ³a phim khá»i danh sÃ¡ch yÃªu thÃ­ch

**APIs:**
- `GET /api/show/all` - Láº¥y danh sÃ¡ch phim
- `GET /api/show/:movieId` - Chi tiáº¿t phim + lá»‹ch chiáº¿u
- `POST /api/user/update-favorite` - Cáº­p nháº­t favorite
- `GET /api/user/favorites` - Láº¥y danh sÃ¡ch favorites

**Äá»‘i tÆ°á»£ng:** Táº¥t cáº£ ngÆ°á»i dÃ¹ng

### 5.3. Module Äáº·t vÃ© (Booking)

**MÃ´ táº£:** Quy trÃ¬nh Ä‘áº·t vÃ© tá»« chá»n gháº¿ Ä‘áº¿n thanh toÃ¡n

**Chá»©c nÄƒng:**
- Xem lá»‹ch chiáº¿u theo ngÃ y vÃ  giá»
- Xem sÆ¡ Ä‘á»“ gháº¿ cá»§a suáº¥t chiáº¿u
- Chá»n gháº¿ ngá»“i (tá»‘i Ä‘a 5 gháº¿)
- Kiá»ƒm tra rÃ ng buá»™c gháº¿ (khÃ´ng Ä‘á»ƒ trá»‘ng 1 gháº¿)
- Táº¡o booking vÃ  chuyá»ƒn sang thanh toÃ¡n

**APIs:**
- `GET /api/booking/seats/:showId` - Láº¥y gháº¿ Ä‘Ã£ Ä‘áº·t
- `POST /api/booking/create` - Táº¡o booking má»›i

**Quy táº¯c nghiá»‡p vá»¥:**
- Pháº£i Ä‘Äƒng nháº­p má»›i Ä‘áº·t Ä‘Æ°á»£c vÃ©
- Tá»‘i Ä‘a 5 gháº¿/booking
- KhÃ´ng Ä‘á»ƒ trá»‘ng Ä‘Ãºng 1 gháº¿ Ä‘Æ¡n
- Gháº¿ Ä‘Æ°á»£c chiáº¿m ngay sau khi táº¡o booking

**Äá»‘i tÆ°á»£ng:** User Ä‘Ã£ Ä‘Äƒng nháº­p

### 5.4. Module Thanh toÃ¡n (Payment)

**MÃ´ táº£:** Xá»­ lÃ½ thanh toÃ¡n trá»±c tuyáº¿n qua Stripe

**Chá»©c nÄƒng:**
- Táº¡o Stripe Checkout Session
- Redirect Ä‘áº¿n trang thanh toÃ¡n Stripe
- Xá»­ lÃ½ webhook tá»« Stripe
- Cáº­p nháº­t tráº¡ng thÃ¡i booking sau thanh toÃ¡n
- Gá»­i email xÃ¡c nháº­n

**APIs:**
- `POST /api/booking/create` - Táº¡o payment session
- `POST /api/stripe` - Webhook endpoint

**Quy táº¯c nghiá»‡p vá»¥:**
- Thá»i gian thanh toÃ¡n: 30 phÃºt
- Náº¿u khÃ´ng thanh toÃ¡n trong 10 phÃºt â†’ Tá»± Ä‘á»™ng há»§y
- Sau khi thanh toÃ¡n thÃ nh cÃ´ng â†’ Gá»­i email xÃ¡c nháº­n

**CÃ´ng nghá»‡:** Stripe Checkout

**Äá»‘i tÆ°á»£ng:** User Ä‘Ã£ Ä‘Äƒng nháº­p

### 5.5. Module Quáº£n lÃ½ Booking (My Bookings)

**MÃ´ táº£:** Xem lá»‹ch sá»­ Ä‘áº·t vÃ© cÃ¡ nhÃ¢n

**Chá»©c nÄƒng:**
- Xem táº¥t cáº£ bookings (paid vÃ  unpaid)
- Xem chi tiáº¿t booking (phim, giá» chiáº¿u, gháº¿, giÃ¡)
- Thanh toÃ¡n láº¡i cho booking chÆ°a thanh toÃ¡n
- Hiá»ƒn thá»‹ tráº¡ng thÃ¡i rÃµ rÃ ng

**APIs:**
- `GET /api/user/bookings` - Láº¥y bookings cá»§a user

**Äá»‘i tÆ°á»£ng:** User Ä‘Ã£ Ä‘Äƒng nháº­p

### 5.6. Module Quáº£n trá»‹ (Admin)

**MÃ´ táº£:** CÃ´ng cá»¥ quáº£n lÃ½ cho admin

**Chá»©c nÄƒng:**

#### 6.1. Dashboard
- Tá»•ng sá»‘ bookings (Ä‘Ã£ thanh toÃ¡n)
- Tá»•ng doanh thu
- Sá»‘ shows Ä‘ang hoáº¡t Ä‘á»™ng
- Tá»•ng sá»‘ users
- Danh sÃ¡ch shows sáº¯p tá»›i

#### 6.2. Quáº£n lÃ½ Suáº¥t chiáº¿u
- Xem danh sÃ¡ch phim Ä‘ang chiáº¿u tá»« TMDB
- ThÃªm suáº¥t chiáº¿u má»›i (chá»n phim, giÃ¡, ngÃ y giá»)
- Xem danh sÃ¡ch táº¥t cáº£ shows
- Xem sá»‘ gháº¿ Ä‘Ã£ Ä‘áº·t cho má»—i show

#### 6.3. Quáº£n lÃ½ Bookings
- Xem táº¥t cáº£ bookings
- ThÃ´ng tin: User, phim, giá», gháº¿, giÃ¡, tráº¡ng thÃ¡i

**APIs:**
- `GET /api/admin/dashboard` - Dashboard data
- `GET /api/show/now-playing` - Phim tá»« TMDB
- `POST /api/show/add` - ThÃªm shows
- `GET /api/admin/all-shows` - Táº¥t cáº£ shows
- `GET /api/admin/all-bookings` - Táº¥t cáº£ bookings

**PhÃ¢n quyá»n:** Chá»‰ admin (kiá»ƒm tra qua `privateMetadata.role`)

**Äá»‘i tÆ°á»£ng:** Admin

---

## ğŸš€ 6. CHá»¨C NÄ‚NG Má» Rá»˜NG

CÃ¡c tÃ­nh nÄƒng cÃ³ thá»ƒ phÃ¡t triá»ƒn trong tÆ°Æ¡ng lai:

### 6.1. Má»©c Ä‘á»™ Æ°u tiÃªn cao â­â­â­

#### 6.1.1. Quáº£n lÃ½ nhiá»u phÃ²ng chiáº¿u
**MÃ´ táº£:** Há»— trá»£ nhiá»u phÃ²ng chiáº¿u vá»›i sÆ¡ Ä‘á»“ gháº¿ khÃ¡c nhau

**Thay Ä‘á»•i cáº§n thiáº¿t:**
- ThÃªm trÆ°á»ng `room` vÃ o Show model
- Cho phÃ©p admin táº¡o vÃ  quáº£n lÃ½ rooms
- Má»—i room cÃ³ sÆ¡ Ä‘á»“ gháº¿ riÃªng
- Kiá»ƒm tra conflict lá»‹ch chiáº¿u cho cÃ¹ng room

**Lá»£i Ã­ch:**
- Pháº£n Ã¡nh thá»±c táº¿ ráº¡p phim cÃ³ nhiá»u phÃ²ng
- CÃ³ thá»ƒ chiáº¿u nhiá»u phim cÃ¹ng lÃºc
- TÄƒng doanh thu

#### 6.1.2. PhÃ¢n loáº¡i gháº¿ vÃ  giÃ¡ linh hoáº¡t
**MÃ´ táº£:** Gháº¿ VIP, thÆ°á»ng, Ä‘Ã´i vá»›i giÃ¡ khÃ¡c nhau

**Thay Ä‘á»•i cáº§n thiáº¿t:**
- ThÃªm loáº¡i gháº¿ vÃ o seat configuration
- GiÃ¡ theo loáº¡i gháº¿ thay vÃ¬ cá»‘ Ä‘á»‹nh cho cáº£ show
- UI hiá»ƒn thá»‹ mÃ u/icon khÃ¡c nhau cho tá»«ng loáº¡i

**Lá»£i Ã­ch:**
- TÄƒng tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng
- Tá»‘i Æ°u doanh thu

#### 6.1.3. MÃ£ giáº£m giÃ¡ vÃ  Voucher
**MÃ´ táº£:** Há»‡ thá»‘ng khuyáº¿n mÃ£i vá»›i voucher code

**Chá»©c nÄƒng:**
- Admin táº¡o mÃ£ voucher (%, fixed amount)
- User nháº­p mÃ£ khi thanh toÃ¡n
- Giáº£m giÃ¡ tá»± Ä‘á»™ng
- Giá»›i háº¡n sá»‘ lÆ°á»£ng, thá»i háº¡n

**Lá»£i Ã­ch:**
- Marketing vÃ  thu hÃºt khÃ¡ch hÃ ng
- ChÆ°Æ¡ng trÃ¬nh loyalty

### 6.2. Má»©c Ä‘á»™ Æ°u tiÃªn trung bÃ¬nh â­â­

#### 6.2.1. Äáº·t Combo Ä‘á»“ Äƒn
**MÃ´ táº£:** Cho phÃ©p Ä‘áº·t bá»ng ngÃ´, nÆ°á»›c ngá»t kÃ¨m vÃ©

**Chá»©c nÄƒng:**
- Danh sÃ¡ch combo
- Chá»n combo khi Ä‘áº·t vÃ©
- TÃ­nh tá»•ng tiá»n (vÃ© + combo)
- QR code Ä‘á»ƒ nháº­n Ä‘á»“ táº¡i quáº§y

#### 6.2.2. Review vÃ  Rating
**MÃ´ táº£:** User Ä‘Ã¡nh giÃ¡ vÃ  bÃ¬nh luáº­n phim

**Chá»©c nÄƒng:**
- Rating 1-5 sao
- Viáº¿t review
- Xem review cá»§a ngÆ°á»i khÃ¡c
- Like/dislike review

#### 6.2.3. Quáº£n lÃ½ nhiá»u ráº¡p/chi nhÃ¡nh
**MÃ´ táº£:** Há»‡ thá»‘ng cho chuá»—i ráº¡p

**Chá»©c nÄƒng:**
- Quáº£n lÃ½ nhiá»u locations
- User chá»n ráº¡p gáº§n nháº¥t
- Admin quáº£n lÃ½ theo ráº¡p
- Thá»‘ng kÃª theo tá»«ng ráº¡p

#### 6.2.4. ChÆ°Æ¡ng trÃ¬nh thÃ nh viÃªn
**MÃ´ táº£:** TÃ­ch Ä‘iá»ƒm, xáº¿p háº¡ng thÃ nh viÃªn

**Chá»©c nÄƒng:**
- TÃ­ch Ä‘iá»ƒm khi Ä‘áº·t vÃ©
- Äá»•i Ä‘iá»ƒm láº¥y voucher
- CÃ¡c háº¡ng: Bronze, Silver, Gold
- Æ¯u Ä‘Ã£i theo háº¡ng

### 6.3. Má»©c Ä‘á»™ Æ°u tiÃªn tháº¥p â­

#### 6.3.1. Mobile App (iOS/Android)
**MÃ´ táº£:** App di Ä‘á»™ng native

**CÃ´ng nghá»‡:** React Native / Flutter

#### 6.3.2. Social Features
**MÃ´ táº£:** Share, invite báº¡n bÃ¨

**Chá»©c nÄƒng:**
- Share phim lÃªn social media
- Invite báº¡n xem phim cÃ¹ng
- Group booking

#### 6.3.3. AI Recommendation
**MÃ´ táº£:** Gá»£i Ã½ phim dá»±a trÃªn sá»Ÿ thÃ­ch

**CÃ´ng nghá»‡:** Machine Learning

---

## ğŸ“Š 7. BÃO CÃO VÃ€ DASHBOARD

### 7.1. Dashboard Admin (ÄÃ£ cÃ³)

**Metrics hiá»ƒn thá»‹:**

1. **Tá»•ng sá»‘ Bookings**
   - Chá»‰ Ä‘áº¿m bookings Ä‘Ã£ thanh toÃ¡n (`ispaid: true`)
   - Card hiá»ƒn thá»‹ sá»‘ lÆ°á»£ng

2. **Tá»•ng Doanh thu**
   - Sum cá»§a `booking.amount` cho táº¥t cáº£ paid bookings
   - Hiá»ƒn thá»‹ theo currency (USD)

3. **Shows Ä‘ang hoáº¡t Ä‘á»™ng**
   - Sá»‘ lÆ°á»£ng shows cÃ³ `showDateTime >= now`
   - Danh sÃ¡ch shows vá»›i thÃ´ng tin chi tiáº¿t

4. **Tá»•ng sá»‘ Users**
   - Count documents trong User collection

**API:** `GET /api/admin/dashboard`

### 7.2. BÃ¡o cÃ¡o má»Ÿ rá»™ng (Äá» xuáº¥t)

#### 7.2.1. BÃ¡o cÃ¡o Doanh thu

**Metrics:**
- Doanh thu theo ngÃ y/tuáº§n/thÃ¡ng
- Doanh thu theo phim
- Doanh thu theo show
- Xu hÆ°á»›ng tÄƒng/giáº£m
- So sÃ¡nh vá»›i ká»³ trÆ°á»›c

**Biá»ƒu Ä‘á»“:**
- Line chart: Doanh thu theo thá»i gian
- Bar chart: Top phim cÃ³ doanh thu cao nháº¥t
- Pie chart: PhÃ¢n bá»• doanh thu theo thá»ƒ loáº¡i

#### 7.2.2. BÃ¡o cÃ¡o Äáº·t vÃ©

**Metrics:**
- Sá»‘ lÆ°á»£ng booking theo ngÃ y
- Tá»· lá»‡ chuyá»ƒn Ä‘á»•i (booking/visit)
- Tá»· lá»‡ thanh toÃ¡n thÃ nh cÃ´ng
- Tá»· lá»‡ há»§y booking
- Thá»i gian trung bÃ¬nh Ä‘á»ƒ hoÃ n táº¥t booking

**Biá»ƒu Ä‘á»“:**
- Funnel chart: Conversion funnel
- Line chart: Bookings theo giá» trong ngÃ y

#### 7.2.3. BÃ¡o cÃ¡o PhÃ²ng chiáº¿u

**Metrics:**
- Tá»· lá»‡ láº¥p Ä‘áº§y gháº¿ (occupancy rate)
- Sá»‘ gháº¿ trung bÃ¬nh/booking
- Show cÃ³ tá»· lá»‡ Ä‘áº·t cao nháº¥t
- Khung giá» hot nháº¥t

**Biá»ƒu Ä‘á»“:**
- Heat map: Gháº¿ Ä‘Æ°á»£c Ä‘áº·t nhiá»u nháº¥t
- Bar chart: Occupancy rate theo show

#### 7.2.4. BÃ¡o cÃ¡o NgÆ°á»i dÃ¹ng

**Metrics:**
- Sá»‘ user má»›i theo ngÃ y/tuáº§n/thÃ¡ng
- User hoáº¡t Ä‘á»™ng (cÃ³ Ã­t nháº¥t 1 booking)
- Sá»‘ booking trung bÃ¬nh/user
- Chi tiÃªu trung bÃ¬nh/user

**Biá»ƒu Ä‘á»“:**
- Line chart: User growth
- Pie chart: PhÃ¢n bá»• user theo sá»‘ lÆ°á»£ng booking

---

## ğŸ”„ 8. QUY TRÃŒNH NGHIá»†P Vá»¤ CHI TIáº¾T

### 8.1. Quy trÃ¬nh ÄÄƒng kÃ½ vÃ  ÄÄƒng nháº­p

```mermaid
flowchart TD
    Start([User truy cáº­p trang web]) --> CheckAuth{ÄÃ£ Ä‘Äƒng nháº­p?}
    CheckAuth -->|CÃ³| HomePage[Hiá»ƒn thá»‹ trang chá»§]
    CheckAuth -->|KhÃ´ng| ViewOnly[Xem phim mode khÃ¡ch]
    
    ViewOnly --> ClickLogin[Click "ÄÄƒng nháº­p"]
    ClickLogin --> ClerkModal[Clerk hiá»ƒn thá»‹ modal]
    ClerkModal --> ChooseMethod{Chá»n phÆ°Æ¡ng thá»©c}
    
    ChooseMethod -->|Email/Password| EmailForm[Nháº­p email + password]
    ChooseMethod -->|Google| GoogleAuth[OAuth Google]
    ChooseMethod -->|ÄÄƒng kÃ½ má»›i| SignUpForm[Form Ä‘Äƒng kÃ½]
    
    EmailForm --> ClerkAuth[Clerk xÃ¡c thá»±c]
    GoogleAuth --> ClerkAuth
    SignUpForm --> ClerkAuth
    
    ClerkAuth --> Success{ThÃ nh cÃ´ng?}
    Success -->|KhÃ´ng| ShowError[Hiá»ƒn thá»‹ lá»—i]
    ShowError --> ClerkModal
    
    Success -->|CÃ³| CreateSession[Táº¡o session + JWT]
    CreateSession --> TriggerWebhook[Clerk gá»­i webhook]
    TriggerWebhook --> InngestSync[Inngest sync user]
    InngestSync --> SaveDB[LÆ°u user vÃ o MongoDB]
    SaveDB --> HomePage
    HomePage --> End([Sá»­ dá»¥ng há»‡ thá»‘ng])
```

### 8.2. Quy trÃ¬nh Äáº·t vÃ© Chi tiáº¿t

```mermaid
flowchart TD
    Start([User Ä‘Äƒng nháº­p]) --> Browse[Xem danh sÃ¡ch phim]
    Browse --> SelectMovie[Click vÃ o phim]
    SelectMovie --> MovieDetail[Xem chi tiáº¿t phim]
    MovieDetail --> CheckShowTime{CÃ³ suáº¥t chiáº¿u?}
    
    CheckShowTime -->|KhÃ´ng| NoShow[Hiá»ƒn thá»‹ "ChÆ°a cÃ³ suáº¥t chiáº¿u"]
    NoShow --> End1([Káº¿t thÃºc])
    
    CheckShowTime -->|CÃ³| ShowCalendar[Hiá»ƒn thá»‹ lá»‹ch chiáº¿u]
    ShowCalendar --> SelectDate[Chá»n ngÃ y]
    SelectDate --> ShowTimes[Hiá»ƒn thá»‹ giá» chiáº¿u]
    ShowTimes --> SelectTime[Chá»n giá»]
    SelectTime --> RedirectSeat[Chuyá»ƒn Ä‘áº¿n SeatLayout]
    
    RedirectSeat --> LoadSeats[API: GET /booking/seats/:showId]
    LoadSeats --> DisplayMap[Hiá»ƒn thá»‹ sÆ¡ Ä‘á»“ gháº¿]
    DisplayMap --> MarkOccupied[ÄÃ¡nh dáº¥u gháº¿ Ä‘Ã£ Ä‘áº·t]
    
    MarkOccupied --> SelectSeats[User chá»n gháº¿]
    SelectSeats --> CheckLimit{â‰¤ 5 gháº¿?}
    CheckLimit -->|KhÃ´ng| ShowLimitError[Toast: Tá»‘i Ä‘a 5 gháº¿]
    ShowLimitError --> SelectSeats
    
    CheckLimit -->|CÃ³| CheckOccupied{Gháº¿ Ä‘Ã£ bá»‹ Ä‘áº·t?}
    CheckOccupied -->|CÃ³| ShowOccupiedError[Toast: Gháº¿ Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t]
    ShowOccupiedError --> SelectSeats
    
    CheckOccupied -->|KhÃ´ng| UpdateSelection[Cáº­p nháº­t selectedSeats]
    UpdateSelection --> MoreSeats{Chá»n thÃªm?}
    MoreSeats -->|CÃ³| SelectSeats
    
    MoreSeats -->|KhÃ´ng| ClickPay[Click "Thanh toÃ¡n"]
    ClickPay --> ValidateRules[Kiá»ƒm tra rÃ ng buá»™c gháº¿]
    ValidateRules --> RuleCheck{Há»£p lá»‡?}
    
    RuleCheck -->|KhÃ´ng| ShowRuleError[Toast: Vi pháº¡m quy táº¯c gháº¿]
    ShowRuleError --> SelectSeats
    
    RuleCheck -->|CÃ³| CallAPI[API: POST /booking/create]
    CallAPI --> ServerValidate[Server kiá»ƒm tra gháº¿]
    ServerValidate --> StillAvailable{Gháº¿ cÃ²n trá»‘ng?}
    
    StillAvailable -->|KhÃ´ng| ReturnError[Return error]
    ReturnError --> ShowAPIError[Toast: Gháº¿ Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t]
    ShowAPIError --> ReloadSeats[Reload sÆ¡ Ä‘á»“ gháº¿]
    ReloadSeats --> SelectSeats
    
    StillAvailable -->|CÃ³| CreateBooking[Táº¡o Booking document]
    CreateBooking --> UpdateOccupied[Update Show.occupiedSeats]
    UpdateOccupied --> CreateStripe[Táº¡o Stripe Checkout]
    CreateStripe --> SavePaymentLink[LÆ°u paymentLink vÃ o Booking]
    SavePaymentLink --> TriggerCheck[Trigger Inngest checkpayment]
    TriggerCheck --> ReturnURL[Return Stripe URL]
    ReturnURL --> RedirectStripe[Redirect sang Stripe]
    
    RedirectStripe --> StripePayment[User thanh toÃ¡n trÃªn Stripe]
    StripePayment --> PayDecision{Thanh toÃ¡n?}
    
    PayDecision -->|Cancel| UserCancel[User click Cancel]
    UserCancel --> BackToBookings[Redirect vá» My Bookings]
    BackToBookings --> Wait10[Background: Äá»£i 10 phÃºt]
    Wait10 --> CheckPaid{ispaid = true?}
    CheckPaid -->|KhÃ´ng| ReleaseSeats[Giáº£i phÃ³ng gháº¿]
    ReleaseSeats --> DeleteBooking[XÃ³a booking]
    DeleteBooking --> End2([Káº¿t thÃºc - Booking há»§y])
    
    CheckPaid -->|CÃ³| End3([Káº¿t thÃºc - ÄÃ£ thanh toÃ¡n ká»‹p])
    
    PayDecision -->|Success| StripeWebhook[Stripe gá»­i webhook]
    StripeWebhook --> VerifyWebhook[Verify signature]
    VerifyWebhook --> UpdatePaid[Update ispaid = true]
    UpdatePaid --> ClearLink[Clear paymentLink]
    ClearLink --> TriggerEmail[Trigger Inngest show.booked]
    TriggerEmail --> SendEmail[Gá»­i email xÃ¡c nháº­n]
    SendEmail --> RedirectSuccess[Redirect vá» success page]
    RedirectSuccess --> End4([HoÃ n thÃ nh - Äáº·t vÃ© thÃ nh cÃ´ng])
```

### 8.3. Quy trÃ¬nh Admin ThÃªm Suáº¥t chiáº¿u

```mermaid
flowchart TD
    Start([Admin Ä‘Äƒng nháº­p]) --> AccessAdmin[Truy cáº­p Admin Panel]
    AccessAdmin --> CheckRole{Role = admin?}
    CheckRole -->|KhÃ´ng| Forbidden[403 Forbidden]
    Forbidden --> End1([Káº¿t thÃºc])
    
    CheckRole -->|CÃ³| ShowMenu[Hiá»ƒn thá»‹ Admin Menu]
    ShowMenu --> ClickAdd[Click "ThÃªm ChÆ°Æ¡ng trÃ¬nh"]
    ClickAdd --> FetchTMDB[API: GET /show/now-playing]
    FetchTMDB --> CallTMDB[Backend gá»i TMDB API]
    CallTMDB --> ReturnMovies[Return danh sÃ¡ch phim]
    ReturnMovies --> DisplayMovies[Hiá»ƒn thá»‹ grid phim]
    
    DisplayMovies --> SelectMovie[Admin chá»n phim]
    SelectMovie --> HighlightMovie[Highlight phim Ä‘Ã£ chá»n]
    HighlightMovie --> InputPrice[Nháº­p giÃ¡ vÃ©]
    InputPrice --> InputDateTime[Nháº­p ngÃ y-giá» chiáº¿u]
    
    InputDateTime --> ClickAddTime[Click "ThÃªm thá»i gian"]
    ClickAddTime --> AddToList[ThÃªm vÃ o dateTimeSelection]
    AddToList --> MoreTimes{ThÃªm ná»¯a?}
    MoreTimes -->|CÃ³| InputDateTime
    
    MoreTimes -->|KhÃ´ng| ReviewSelection[Xem láº¡i thÃ´ng tin]
    ReviewSelection --> ClickSubmit[Click "ThÃªm chÆ°Æ¡ng trÃ¬nh"]
    ClickSubmit --> ValidateForm{Äáº§y Ä‘á»§ thÃ´ng tin?}
    
    ValidateForm -->|KhÃ´ng| ShowValidateError[Toast: Thiáº¿u thÃ´ng tin]
    ShowValidateError --> ReviewSelection
    
    ValidateForm -->|CÃ³| CallAddAPI[API: POST /show/add]
    CallAddAPI --> CheckMovieDB{Phim cÃ³ trong DB?}
    
    CheckMovieDB -->|CÃ³| UseExisting[DÃ¹ng Movie cÃ³ sáºµn]
    UseExisting --> CreateShows[Táº¡o Show documents]
    
    CheckMovieDB -->|KhÃ´ng| FetchDetails[Fetch movie details tá»« TMDB]
    FetchDetails --> FetchCredits[Fetch movie credits tá»« TMDB]
    FetchCredits --> CreateMovie[Táº¡o Movie document]
    CreateMovie --> CreateShows
    
    CreateShows --> LoopShows[Loop qua showsInput]
    LoopShows --> ParseDateTime[Parse date + time]
    ParseDateTime --> BuildShowDoc[Build Show document]
    BuildShowDoc --> NextShow{CÃ²n show?}
    NextShow -->|CÃ³| LoopShows
    
    NextShow -->|KhÃ´ng| InsertMany[insertMany vÃ o DB]
    InsertMany --> TriggerNotif[Trigger Inngest show.added]
    TriggerNotif --> GetUsers[Láº¥y táº¥t cáº£ users]
    GetUsers --> LoopUsers[Loop qua users]
    LoopUsers --> SendNotifEmail[Gá»­i email thÃ´ng bÃ¡o]
    SendNotifEmail --> NextUser{CÃ²n user?}
    NextUser -->|CÃ³| LoopUsers
    
    NextUser -->|KhÃ´ng| ReturnSuccess[Return success]
    ReturnSuccess --> ShowToast[Toast: ThÃ nh cÃ´ng]
    ShowToast --> ResetForm[Reset form]
    ResetForm --> End2([HoÃ n thÃ nh])
```

### 8.4. Quy trÃ¬nh Gá»­i Email Nháº¯c nhá»Ÿ

```mermaid
flowchart TD
    Start([Cron job: Má»—i 8 giá»]) --> TriggerInngest[Inngest: send-show-reminders]
    TriggerInngest --> GetTime[Láº¥y thá»i gian hiá»‡n táº¡i]
    GetTime --> Calculate[TÃ­nh thá»i gian +8 giá»]
    Calculate --> QueryShows[Query shows trong khoáº£ng 8 giá» tá»›i]
    
    QueryShows --> CheckShows{CÃ³ shows?}
    CheckShows -->|KhÃ´ng| Return0[Return: KhÃ´ng cÃ³ reminder]
    Return0 --> End1([Káº¿t thÃºc])
    
    CheckShows -->|CÃ³| LoopShows[Loop qua tá»«ng show]
    LoopShows --> CheckSeats{CÃ³ occupiedSeats?}
    CheckSeats -->|KhÃ´ng| NextShow1{CÃ²n show?}
    NextShow1 -->|CÃ³| LoopShows
    NextShow1 -->|KhÃ´ng| SendEmails
    
    CheckSeats -->|CÃ³| ExtractUsers[Extract userIds tá»« occupiedSeats]
    ExtractUsers --> UniqueUsers[Lá»c unique userIds]
    UniqueUsers --> QueryUsers[Query users tá»« DB]
    QueryUsers --> BuildTasks[Build reminder tasks]
    BuildTasks --> NextShow2{CÃ²n show?}
    NextShow2 -->|CÃ³| LoopShows
    
    NextShow2 -->|KhÃ´ng| SendEmails[Gá»­i táº¥t cáº£ emails]
    SendEmails --> PromiseAll[Promise.allSettled]
    PromiseAll --> CountResults[Äáº¿m succeeded/failed]
    CountResults --> LogResults[Log káº¿t quáº£]
    LogResults --> End2([Káº¿t thÃºc])
```

---

## ğŸ”§ 9. YÃŠU Cáº¦U PHI CHá»¨C NÄ‚NG

### 9.1. Hiá»‡u nÄƒng (Performance)

#### 9.1.1. Thá»i gian táº£i trang
- âš¡ **Trang chá»§**: < 2 giÃ¢y (First Contentful Paint)
- âš¡ **Trang chi tiáº¿t phim**: < 1.5 giÃ¢y
- âš¡ **Trang chá»n gháº¿**: < 1 giÃ¢y
- âš¡ **API response time**: < 500ms (95th percentile)

#### 9.1.2. Äá»“ng thá»i (Concurrency)
- ğŸ‘¥ Há»— trá»£ **100+ users Ä‘á»“ng thá»i** xem phim
- ğŸ‘¥ **20+ bookings Ä‘á»“ng thá»i** khÃ´ng bá»‹ conflict
- ğŸ‘¥ Database connection pool: 10-50 connections

#### 9.1.3. Tá»‘i Æ°u hÃ³a
- ğŸ“¦ Code splitting cho React app
- ğŸ–¼ï¸ Lazy load images
- ğŸ’¾ Cache API responses (TMDB data)
- ğŸ—œï¸ Gzip compression
- ğŸ¯ CDN cho static assets (Vercel)

### 9.2. Báº£o máº­t (Security)

#### 9.2.1. Authentication & Authorization
- ğŸ” JWT token vá»›i expiration
- ğŸ” HttpOnly cookies cho sensitive data
- ğŸ” Role-based access control (User/Admin)
- ğŸ” Protected API routes vá»›i middleware

#### 9.2.2. Data Protection
- ğŸ›¡ï¸ KhÃ´ng lÆ°u password (Clerk xá»­ lÃ½)
- ğŸ›¡ï¸ MÃ£ hÃ³a dá»¯ liá»‡u nháº¡y cáº£m
- ğŸ›¡ï¸ HTTPS báº¯t buá»™c (production)
- ğŸ›¡ï¸ Validate input Ä‘á»ƒ chá»‘ng injection

#### 9.2.3. Payment Security
- ğŸ’³ PCI-DSS compliant (qua Stripe)
- ğŸ’³ Webhook signature verification
- ğŸ’³ KhÃ´ng lÆ°u thÃ´ng tin tháº»
- ğŸ’³ HTTPS cho táº¥t cáº£ payment flows

#### 9.2.4. API Security
- ğŸš« Rate limiting (Ä‘á» xuáº¥t: 100 req/15min/IP)
- ğŸš« CORS configuration
- ğŸš« Helmet.js cho HTTP headers
- ğŸš« Input sanitization

### 9.3. Äá»™ tin cáº­y (Reliability)

#### 9.3.1. Availability
- âœ… **Uptime**: 99.5% (Target)
- âœ… Graceful degradation khi service bÃªn ngoÃ i down
- âœ… Error boundaries trong React
- âœ… Retry logic cho failed API calls

#### 9.3.2. Data Consistency
- ğŸ”„ Atomic operations cho booking (transaction-like)
- ğŸ”„ Kiá»ƒm tra double-booking
- ğŸ”„ Auto-cleanup booking chÆ°a thanh toÃ¡n
- ğŸ”„ Backup database Ä‘á»‹nh ká»³ (MongoDB Atlas)

#### 9.3.3. Error Handling
- âŒ Comprehensive error messages
- âŒ Logging errors (console, cÃ³ thá»ƒ má»Ÿ rá»™ng sang Sentry)
- âŒ User-friendly error pages
- âŒ Fallback UI khi component lá»—i

### 9.4. Kháº£ nÄƒng má»Ÿ rá»™ng (Scalability)

#### 9.4.1. Horizontal Scaling
- ğŸ“ˆ Stateless backend (cÃ³ thá»ƒ deploy nhiá»u instances)
- ğŸ“ˆ Load balancing (Railway há»— trá»£)
- ğŸ“ˆ Database sharding (náº¿u cáº§n trong tÆ°Æ¡ng lai)

#### 9.4.2. Database
- ğŸ’¾ MongoDB Atlas cÃ³ thá»ƒ scale tá»± Ä‘á»™ng
- ğŸ’¾ Indexing cho query thÆ°á»ng dÃ¹ng:
  - `Show.showDateTime`
  - `Booking.user`
  - `User.email`

#### 9.4.3. Background Jobs
- âš™ï¸ Inngest tá»± Ä‘á»™ng scale workers
- âš™ï¸ Queue-based processing
- âš™ï¸ Retry failed jobs

### 9.5. Kháº£ nÄƒng sá»­ dá»¥ng (Usability)

#### 9.5.1. User Experience
- ğŸ¨ **Giao diá»‡n Ä‘áº¹p**: Modern, clean UI vá»›i Tailwind
- ğŸ¨ **Responsive**: Hoáº¡t Ä‘á»™ng tá»‘t trÃªn mobile, tablet, desktop
- ğŸ¨ **Intuitive**: Quy trÃ¬nh Ä‘áº·t vÃ© Ä‘Æ¡n giáº£n, rÃµ rÃ ng
- ğŸ¨ **Feedback**: Toast notifications cho má»i action

#### 9.5.2. Accessibility
- â™¿ Semantic HTML
- â™¿ Alt text cho images
- â™¿ Keyboard navigation
- â™¿ Color contrast Ä‘áº¡t chuáº©n WCAG (Ä‘á» xuáº¥t)

#### 9.5.3. Performance UX
- â³ Loading states cho async operations
- â³ Skeleton screens
- â³ Optimistic UI updates
- â³ Progress indicators

### 9.6. Kháº£ nÄƒng báº£o trÃ¬ (Maintainability)

#### 9.6.1. Code Quality
- ğŸ“ Clean code, readable
- ğŸ“ DRY principle
- ğŸ“ Separation of concerns (MVC pattern)
- ğŸ“ Consistent naming conventions

#### 9.6.2. Documentation
- ğŸ“š README vá»›i hÆ°á»›ng dáº«n setup
- ğŸ“š API documentation (file nÃ y)
- ğŸ“š Code comments cho logic phá»©c táº¡p
- ğŸ“š Environment variables documented

#### 9.6.3. Version Control
- ğŸ”€ Git vá»›i meaningful commit messages
- ğŸ”€ Feature branches
- ğŸ”€ Pull requests (náº¿u team)

### 9.7. TÆ°Æ¡ng thÃ­ch (Compatibility)

#### 9.7.1. Browser Support
- âœ… Chrome/Edge (latest 2 versions)
- âœ… Firefox (latest 2 versions)
- âœ… Safari (latest 2 versions)
- âœ… Mobile browsers (iOS Safari, Chrome Mobile)

#### 9.7.2. Device Support
- ğŸ“± Mobile: 375px trá»Ÿ lÃªn
- ğŸ’» Tablet: 768px trá»Ÿ lÃªn
- ğŸ–¥ï¸ Desktop: 1024px trá»Ÿ lÃªn

---

## ğŸ“ 10. TIÃŠU CHÃ ÄÃNH GIÃ

### 10.1. TiÃªu chÃ­ Chá»©c nÄƒng

#### 10.1.1. Äáº·t vÃ©
| TiÃªu chÃ­ | Má»©c Ä‘á»™ hoÃ n thÃ nh | Ghi chÃº |
|----------|-------------------|---------|
| User cÃ³ thá»ƒ xem danh sÃ¡ch phim | âœ… 100% | Hoáº¡t Ä‘á»™ng tá»‘t |
| User cÃ³ thá»ƒ xem chi tiáº¿t phim | âœ… 100% | CÃ³ Ä‘áº§y Ä‘á»§ info tá»« TMDB |
| User cÃ³ thá»ƒ xem lá»‹ch chiáº¿u | âœ… 100% | Group theo ngÃ y ráº¥t trá»±c quan |
| User cÃ³ thá»ƒ chá»n gháº¿ | âœ… 100% | SÆ¡ Ä‘á»“ gháº¿ interactive |
| Kiá»ƒm tra rÃ ng buá»™c gháº¿ | âœ… 100% | Validation cháº·t cháº½ |
| KhÃ´ng Ä‘áº·t trÃ¹ng gháº¿ | âœ… 100% | Server-side check |
| Thanh toÃ¡n Stripe | âœ… 100% | TÃ­ch há»£p tá»‘t |
| Nháº­n email xÃ¡c nháº­n | âœ… 100% | Gá»­i qua Inngest |

**Äiá»ƒm: 10/10**

#### 10.1.2. Quáº£n trá»‹
| TiÃªu chÃ­ | Má»©c Ä‘á»™ hoÃ n thÃ nh | Ghi chÃº |
|----------|-------------------|---------|
| Dashboard thá»‘ng kÃª | âœ… 100% | CÃ³ Ä‘á»§ metrics cÆ¡ báº£n |
| ThÃªm suáº¥t chiáº¿u | âœ… 100% | UI tá»‘t, fetch tá»« TMDB |
| Xem danh sÃ¡ch shows | âœ… 100% | CÃ³ thÃ´ng tin Ä‘áº§y Ä‘á»§ |
| Xem danh sÃ¡ch bookings | âœ… 100% | Filter vÃ  sort tá»‘t |
| PhÃ¢n quyá»n admin | âœ… 100% | Secure vá»›i Clerk |

**Äiá»ƒm: 10/10**

### 10.2. TiÃªu chÃ­ Ká»¹ thuáº­t

#### 10.2.1. Kiáº¿n trÃºc
| TiÃªu chÃ­ | ÄÃ¡nh giÃ¡ | Äiá»ƒm |
|----------|----------|------|
| Separation of concerns | âœ… Tá»‘t | 9/10 |
| Code organization | âœ… RÃµ rÃ ng | 9/10 |
| RESTful API design | âœ… Chuáº©n | 9/10 |
| Error handling | âš ï¸ CÃ³ thá»ƒ cáº£i thiá»‡n | 7/10 |
| Security | âœ… Tá»‘t (Clerk + Stripe) | 9/10 |

**Äiá»ƒm trung bÃ¬nh: 8.6/10**

#### 10.2.2. Database Design
| TiÃªu chÃ­ | ÄÃ¡nh giÃ¡ | Äiá»ƒm |
|----------|----------|------|
| Schema design | âœ… Há»£p lÃ½ | 9/10 |
| Relationships | âœ… ÄÃºng | 9/10 |
| Indexing | âš ï¸ Cáº§n thÃªm | 7/10 |
| Data consistency | âœ… Tá»‘t | 8/10 |

**Äiá»ƒm trung bÃ¬nh: 8.25/10**

### 10.3. TiÃªu chÃ­ UX/UI

| TiÃªu chÃ­ | ÄÃ¡nh giÃ¡ | Äiá»ƒm |
|----------|----------|------|
| Visual design | âœ… Äáº¹p, modern | 9/10 |
| Responsive | âœ… Tá»‘t trÃªn má»i thiáº¿t bá»‹ | 9/10 |
| User flow | âœ… Trá»±c quan, dá»… hiá»ƒu | 9/10 |
| Loading states | âœ… CÃ³ Loading component | 8/10 |
| Error messages | âœ… Toast notifications | 9/10 |
| Accessibility | âš ï¸ CÆ¡ báº£n, cáº§n cáº£i thiá»‡n | 6/10 |

**Äiá»ƒm trung bÃ¬nh: 8.3/10**

### 10.4. TiÃªu chÃ­ Nghiá»‡p vá»¥

#### 10.4.1. Quy trÃ¬nh Ä‘áº·t vÃ©
| TiÃªu chÃ­ | ÄÃ¡nh giÃ¡ | Ghi chÃº |
|----------|----------|---------|
| Sá»‘ bÆ°á»›c Ä‘á»ƒ hoÃ n thÃ nh | âœ… 5-6 bÆ°á»›c | Há»£p lÃ½ |
| Thá»i gian trung bÃ¬nh | âœ… 2-3 phÃºt | Nhanh |
| Tá»· lá»‡ thÃ nh cÃ´ng | âš ï¸ ChÆ°a cÃ³ metrics | - |
| User satisfaction | âš ï¸ ChÆ°a cÃ³ survey | - |

#### 10.4.2. Xá»­ lÃ½ edge cases
| Scenario | Xá»­ lÃ½ | Äiá»ƒm |
|----------|-------|------|
| Gháº¿ bá»‹ Ä‘áº·t Ä‘á»“ng thá»i | âœ… Server check | 10/10 |
| User khÃ´ng thanh toÃ¡n | âœ… Auto-cancel sau 10 phÃºt | 10/10 |
| Stripe timeout | âœ… 30 phÃºt expiry | 10/10 |
| User cancel payment | âœ… Redirect vá» bookings | 9/10 |
| Network error | âš ï¸ Cáº§n retry logic | 7/10 |

**Äiá»ƒm trung bÃ¬nh: 9.2/10**

### 10.5. TiÃªu chÃ­ Má»Ÿ rá»™ng

| TiÃªu chÃ­ | ÄÃ¡nh giÃ¡ | Äiá»ƒm |
|----------|----------|------|
| Code extensibility | âœ… Dá»… má»Ÿ rá»™ng | 8/10 |
| Scalability | âœ… Stateless, cÃ³ thá»ƒ scale | 8/10 |
| Documentation | âœ… TÃ i liá»‡u Ä‘áº§y Ä‘á»§ | 9/10 |
| Testing | âŒ ChÆ°a cÃ³ tests | 0/10 |
| CI/CD | âš ï¸ Basic (Vercel/Railway auto deploy) | 6/10 |

**Äiá»ƒm trung bÃ¬nh: 6.2/10**

### 10.6. Tá»•ng káº¿t ÄÃ¡nh giÃ¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ KhÃ­a cáº¡nh                            â”‚ Äiá»ƒm   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Chá»©c nÄƒng (Features)              â”‚ 10/10  â”‚
â”‚ 2. Ká»¹ thuáº­t (Technical)              â”‚ 8.4/10 â”‚
â”‚ 3. UX/UI                             â”‚ 8.3/10 â”‚
â”‚ 4. Nghiá»‡p vá»¥ (Business Logic)        â”‚ 9.2/10 â”‚
â”‚ 5. Kháº£ nÄƒng má»Ÿ rá»™ng (Extensibility)  â”‚ 6.2/10 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tá»”NG ÄIá»‚M TRUNG BÃŒNH                 â”‚ 8.4/10 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.7. Äiá»ƒm Máº¡nh

âœ… **Chá»©c nÄƒng Ä‘áº§y Ä‘á»§**: Táº¥t cáº£ requirements cá»‘t lÃµi Ä‘á»u Ä‘Æ°á»£c triá»ƒn khai  
âœ… **UX tá»‘t**: Giao diá»‡n Ä‘áº¹p, quy trÃ¬nh Ä‘áº·t vÃ© mÆ°á»£t mÃ   
âœ… **TÃ­ch há»£p tá»‘t**: Clerk, Stripe, TMDB, Inngest hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh  
âœ… **Background jobs**: Tá»± Ä‘á»™ng hÃ³a tá»‘t (email, cleanup)  
âœ… **Security**: Sá»­ dá»¥ng cÃ¡c dá»‹ch vá»¥ Ä‘Ã¡ng tin cáº­y  
âœ… **Code quality**: Clean, organized, dá»… Ä‘á»c  
âœ… **Documentation**: TÃ i liá»‡u chi tiáº¿t  

### 10.8. Äiá»ƒm Cáº§n Cáº£i thiá»‡n

âš ï¸ **Testing**: ChÆ°a cÃ³ unit tests, integration tests  
âš ï¸ **Error handling**: CÃ³ thá»ƒ chi tiáº¿t vÃ  xá»­ lÃ½ tá»‘t hÆ¡n  
âš ï¸ **Monitoring**: ChÆ°a cÃ³ logging/monitoring system  
âš ï¸ **Accessibility**: Cáº§n cáº£i thiá»‡n Ä‘á»ƒ Ä‘áº¡t chuáº©n WCAG  
âš ï¸ **Scalability**: Giá»›i háº¡n 1 phÃ²ng chiáº¿u  
âš ï¸ **Advanced features**: ChÆ°a cÃ³ voucher, combo, review  
âš ï¸ **Analytics**: ChÆ°a cÃ³ bÃ¡o cÃ¡o chi tiáº¿t  

### 10.9. Khuyáº¿n nghá»‹

#### Ngáº¯n háº¡n (1-3 thÃ¡ng):
1. âœï¸ Viáº¿t unit tests cho core functions
2. ğŸ“Š ThÃªm error logging (Sentry hoáº·c tÆ°Æ¡ng tá»±)
3. ğŸ¯ Implement rate limiting
4. â™¿ Cáº£i thiá»‡n accessibility

#### Trung háº¡n (3-6 thÃ¡ng):
1. ğŸ¬ ThÃªm quáº£n lÃ½ nhiá»u phÃ²ng chiáº¿u
2. ğŸ« PhÃ¢n loáº¡i gháº¿ vÃ  giÃ¡ linh hoáº¡t
3. ğŸ’° Há»‡ thá»‘ng voucher/discount
4. ğŸ“ˆ Advanced analytics dashboard

#### DÃ i háº¡n (6-12 thÃ¡ng):
1. ğŸ“± Mobile app (React Native)
2. ğŸ¿ Äáº·t combo Ä‘á»“ Äƒn
3. â­ Review vÃ  rating system
4. ğŸ¢ Quáº£n lÃ½ nhiá»u ráº¡p/chuá»—i ráº¡p

---

## ğŸ¬ MÃ” HÃŒNH PHÃ’NG CHIáº¾U

### âš ï¸ Äáº¶C ÄIá»‚M QUAN TRá»ŒNG

**Há»‡ thá»‘ng chá»‰ cÃ³ 1 PHÃ’NG CHIáº¾U duy nháº¥t.**

- KhÃ´ng cÃ³ khÃ¡i niá»‡m nhiá»u ráº¡p (cinema) hay nhiá»u phÃ²ng chiáº¿u (theater/hall)
- Táº¥t cáº£ cÃ¡c suáº¥t chiáº¿u (shows) Ä‘á»u sá»­ dá»¥ng **chung má»™t sÆ¡ Ä‘á»“ gháº¿ cá»‘ Ä‘á»‹nh**
- Model `Show` **khÃ´ng cÃ³** trÆ°á»ng `theater`, `room`, hay `cinema_hall`

### ğŸ“ SÆ  Äá»’ GHáº¾ NGá»’I

#### Cáº¥u trÃºc gháº¿:

```
SCREEN (MÃ n hÃ¬nh)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        [A1] [A2] [A3] [A4] [A5] [A6] [A7] [A8] [A9]
        [B1] [B2] [B3] [B4] [B5] [B6] [B7] [B8] [B9]

[C1] [C2] [C3] [C4] [C5] [C6] [C7] [C8] [C9]    [G1] [G2] [G3] [G4] [G5] [G6] [G7] [G8] [G9]
[D1] [D2] [D3] [D4] [D5] [D6] [D7] [D8] [D9]    [H1] [H2] [H3] [H4] [H5] [H6] [H7] [H8] [H9]

[E1] [E2] [E3] [E4] [E5] [E6] [E7] [E8] [E9]    [I1] [I2] [I3] [I4] [I5] [I6] [I7] [I8] [I9]
[F1] [F2] [F3] [F4] [F5] [F6] [F7] [F8] [F9]    [J1] [J2] [J3] [J4] [J5] [J6] [J7] [J8] [J9]
```

#### ThÃ´ng sá»‘:
- **Sá»‘ hÃ ng gháº¿**: 10 hÃ ng (A, B, C, D, E, F, G, H, I, J)
- **Gháº¿ má»—i hÃ ng**: 9 gháº¿ (tá»« 1 Ä‘áº¿n 9)
- **Tá»•ng sá»‘ gháº¿**: 90 gháº¿

#### NhÃ³m gháº¿ trong code:

```javascript
const groupRows = [
  ["A", "B"],              // HÃ ng phÃ­a trÃªn (2 hÃ ng)
  ["C", "D"],              // Cá»™t trÃ¡i, nhÃ³m 1
  ["E", "F"],              // Cá»™t trÃ¡i, nhÃ³m 2
  ["G", "H"],              // Cá»™t pháº£i, nhÃ³m 1
  ["I", "J"]               // Cá»™t pháº£i, nhÃ³m 2
]
```

### ğŸ’¾ QUáº¢N LÃ GHáº¾ ÄÃƒ Äáº¶T

Má»—i suáº¥t chiáº¿u lÆ°u thÃ´ng tin gháº¿ Ä‘Ã£ Ä‘áº·t trong trÆ°á»ng `occupiedSeats`:

```javascript
occupiedSeats: {
  "A1": "user_2abc123",    // Gháº¿ A1 Ä‘Æ°á»£c Ä‘áº·t bá»Ÿi user cÃ³ ID nÃ y
  "A2": "user_2abc123",    // Gháº¿ A2 cÅ©ng Ä‘Æ°á»£c Ä‘áº·t bá»Ÿi cÃ¹ng user
  "B5": "user_2xyz456",    // Gháº¿ B5 Ä‘Æ°á»£c Ä‘áº·t bá»Ÿi user khÃ¡c
  // ... cÃ¡c gháº¿ khÃ¡c
}
```

**Äáº·c Ä‘iá»ƒm:**
- `occupiedSeats` lÃ  má»™t **Object**, khÃ´ng pháº£i Array
- **Key**: TÃªn gháº¿ (vÃ­ dá»¥: "A1", "B5", "J9")
- **Value**: ID cá»§a ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘áº·t gháº¿ Ä‘Ã³
- **Default**: `{}` (object rá»—ng - khÃ´ng cÃ³ gháº¿ nÃ o bá»‹ chiáº¿m)
- Schema cÃ³ `minimize: false` Ä‘á»ƒ giá»¯ nguyÃªn structure khi object rá»—ng

---

## ğŸ—„ï¸ MÃ” HÃŒNH Dá»® LIá»†U CHI TIáº¾T

### 1ï¸âƒ£ User Model

LÆ°u thÃ´ng tin ngÆ°á»i dÃ¹ng (Ä‘á»“ng bá»™ tá»« Clerk).

```javascript
{
  _id: String,           // ID tá»« Clerk (vÃ­ dá»¥: "user_2abc123")
  name: String,          // TÃªn Ä‘áº§y Ä‘á»§
  email: String,         // Email (unique)
  image: String          // URL áº£nh Ä‘áº¡i diá»‡n
}
```

**LÆ°u Ã½:**
- `_id` lÃ  String (khÃ´ng pháº£i ObjectId cá»§a MongoDB)
- Dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘á»“ng bá»™ tá»± Ä‘á»™ng qua Inngest webhooks tá»« Clerk
- Danh sÃ¡ch phim yÃªu thÃ­ch lÆ°u trong **Clerk privateMetadata**, khÃ´ng lÆ°u trong DB

### 2ï¸âƒ£ Movie Model

ThÃ´ng tin phim tá»« TMDB API.

```javascript
{
  _id: String,              // ID phim tá»« TMDB (vÃ­ dá»¥: "872585")
  title: String,            // TÃªn phim
  overview: String,         // MÃ´ táº£/tÃ³m táº¯t phim
  poster_path: String,      // ÄÆ°á»ng dáº«n poster (/xyz.jpg)
  backdrop_path: String,    // ÄÆ°á»ng dáº«n áº£nh ná»n
  release_date: String,     // NgÃ y phÃ¡t hÃ nh (YYYY-MM-DD)
  original_language: String,// NgÃ´n ngá»¯ gá»‘c (vi dá»¥: "en")
  tagline: String,          // CÃ¢u tagline
  genres: Array,            // [{id: 28, name: "Action"}, ...]
  casts: Array,             // [{name: "...", profile_path: "..."}, ...]
  vote_average: Number,     // Äiá»ƒm Ä‘Ã¡nh giÃ¡ (0-10)
  runtime: Number,          // Thá»i lÆ°á»£ng (phÃºt)
  createdAt: Date,          // Tá»± Ä‘á»™ng
  updatedAt: Date           // Tá»± Ä‘á»™ng
}
```

### 3ï¸âƒ£ Show Model â­

Suáº¥t chiáº¿u - **TÃ‚M ÄIá»‚M Cá»¦A Há»† THá»NG**.

```javascript
{
  movie: String,            // Ref Ä‘áº¿n Movie._id
  showDateTime: Date,       // NgÃ y giá» chiáº¿u (ISO Date)
  showPrice: Number,        // GiÃ¡ vÃ© (USD)
  occupiedSeats: Object     // Object {seatId: userId}
}
```

**Äáº·c Ä‘iá»ƒm quan trá»ng:**
- **KHÃ”NG CÃ“ trÆ°á»ng `theater`, `room`, `cinema_hall`** â†’ Chá»‰ cÃ³ 1 phÃ²ng chiáº¿u
- `occupiedSeats` cÃ³ `minimize: false` trong schema Ä‘á»ƒ giá»¯ structure
- Má»—i Show = 1 phim + 1 thá»i gian + 1 sÆ¡ Ä‘á»“ gháº¿ 90 chá»—

**VÃ­ dá»¥ Show document:**

```javascript
{
  _id: ObjectId("..."),
  movie: "872585",
  showDateTime: ISODate("2025-12-25T19:30:00.000Z"),
  showPrice: 12,
  occupiedSeats: {
    "A1": "user_2abc123",
    "A2": "user_2abc123",
    "A3": "user_2abc123",
    "C5": "user_2xyz456"
  }
}
```

### 4ï¸âƒ£ Booking Model

ThÃ´ng tin Ä‘áº·t vÃ©.

```javascript
{
  user: String,             // Ref Ä‘áº¿n User._id
  show: String,             // Ref Ä‘áº¿n Show._id (ObjectId dáº¡ng string)
  amount: Number,           // Tá»•ng tiá»n (showPrice Ã— sá»‘ gháº¿)
  bookedSeats: Array,       // ["A1", "A2", "A3"]
  ispaid: Boolean,          // Tráº¡ng thÃ¡i thanh toÃ¡n (default: false)
  paymentLink: String,      // URL Stripe Checkout
  createdAt: Date,
  updatedAt: Date
}
```

---

## ğŸ”— QUAN Há»† GIá»®A CÃC MODEL

```mermaid
erDiagram
    User ||--o{ Booking : creates
    Movie ||--o{ Show : has
    Show ||--o{ Booking : contains
    Show {
        String movie
        Date showDateTime
        Number showPrice
        Object occupiedSeats
    }
    Booking {
        String user
        String show
        Number amount
        Array bookedSeats
        Boolean ispaid
    }
    User {
        String _id
        String name
        String email
    }
    Movie {
        String _id
        String title
        Array genres
        Array casts
    }
```

**Giáº£i thÃ­ch:**
- 1 User cÃ³ thá»ƒ táº¡o nhiá»u Bookings
- 1 Movie cÃ³ thá»ƒ cÃ³ nhiá»u Shows (cÃ¡c suáº¥t chiáº¿u khÃ¡c nhau)
- 1 Show cÃ³ thá»ƒ cÃ³ nhiá»u Bookings (nhiá»u ngÆ°á»i Ä‘áº·t vÃ© cho cÃ¹ng 1 suáº¥t)
- Show.occupiedSeats lÆ°u táº¥t cáº£ gháº¿ Ä‘Ã£ Ä‘áº·t (tá»« táº¥t cáº£ bookings)

---

## ğŸ‘¤ CHá»¨C NÄ‚NG NGÆ¯á»œI DÃ™NG

### 1. Xem danh sÃ¡ch phim

**Trang Home (`/`):**
- Hero section vá»›i phim ná»•i báº­t
- Featured movies
- Trailers section

**Trang Movies (`/movies`):**
- Hiá»ƒn thá»‹ táº¥t cáº£ phim Ä‘ang cÃ³ suáº¥t chiáº¿u
- Grid layout vá»›i MovieCard

**API:** `GET /api/show/all`

```javascript
// Logic backend
const shows = await Show.find({
  showDateTime: {$gte: new Date()}  // Chá»‰ láº¥y shows sáº¯p tá»›i
}).populate('movie');

// Lá»c unique movies
const uniqueMovies = new Set(shows.map(show => show.movie));
```

### 2. Xem chi tiáº¿t phim

**Trang MovieDetails (`/movies/:id`):**
- Poster, title, overview, rating
- Danh sÃ¡ch diá»…n viÃªn
- **Lá»‹ch chiáº¿u theo ngÃ y vÃ  giá»**
- NÃºt yÃªu thÃ­ch (Heart icon)

**API:** `GET /api/show/:movieId`

```javascript
// Tráº£ vá» format
{
  success: true,
  movie: {...},
  dateTime: {
    "2025-12-25": [
      {time: "2025-12-25T19:30:00Z", showId: "..."},
      {time: "2025-12-25T22:00:00Z", showId: "..."}
    ],
    "2025-12-26": [...]
  }
}
```

### 3. YÃªu thÃ­ch phim (Favorites)

**Chá»©c nÄƒng:**
- Click icon Heart Ä‘á»ƒ thÃªm/xÃ³a phim yÃªu thÃ­ch
- Xem táº¥t cáº£ phim yÃªu thÃ­ch táº¡i `/favorite`

**LÆ°u trá»¯:**
- Danh sÃ¡ch lÆ°u trong **Clerk privateMetadata** (khÃ´ng lÆ°u DB)
- `user.privateMetadata.favorites = ["movieId1", "movieId2", ...]`

**APIs:**
- `POST /api/user/update-favorite` - Toggle favorite
- `GET /api/user/favorites` - Láº¥y danh sÃ¡ch movies tá»« DB

### 4. Äáº·t vÃ© (Seat Booking) â­

**Trang SeatLayout (`/seat-layout/:id/:date`):**

#### Quy trÃ¬nh:

1. **Chá»n thá»i gian chiáº¿u**
   - Sidebar hiá»ƒn thá»‹ cÃ¡c giá» chiáº¿u cÃ³ sáºµn trong ngÃ y Ä‘Ã£ chá»n
   - Click Ä‘á»ƒ chá»n â†’ Load gháº¿ Ä‘Ã£ Ä‘áº·t cho suáº¥t chiáº¿u Ä‘Ã³

2. **Xem sÆ¡ Ä‘á»“ gháº¿**
   - API: `GET /api/booking/seats/:showId` â†’ Tráº£ vá» `occupiedSeats`
   - Gháº¿ Ä‘Ã£ Ä‘áº·t bá»‹ disable (opacity-50, khÃ´ng click Ä‘Æ°á»£c)

3. **Chá»n gháº¿**
   - Click Ä‘á»ƒ chá»n/bá» chá»n gháº¿
   - **Giá»›i háº¡n tá»‘i Ä‘a 5 gháº¿**
   - Gháº¿ Ä‘Ã£ chá»n cÃ³ mÃ u primary (bg-primary)

4. **Kiá»ƒm tra rÃ ng buá»™c gháº¿**
   - Há»‡ thá»‘ng kiá»ƒm tra **khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng Ä‘Ãºng 1 gháº¿** á»Ÿ:
     - BÃªn trÃ¡i dÃ£y gháº¿ Ä‘Ã£ chá»n
     - BÃªn pháº£i dÃ£y gháº¿ Ä‘Ã£ chá»n
     - Giá»¯a 2 gháº¿ Ä‘Ã£ chá»n

5. **Thanh toÃ¡n**
   - Click "Thanh toÃ¡n" â†’ API: `POST /api/booking/create`
   - Backend táº¡o Booking + chiáº¿m gháº¿ + táº¡o Stripe Checkout
   - Redirect sang Stripe Ä‘á»ƒ thanh toÃ¡n

#### RÃ ng buá»™c gháº¿ ngá»“i chi tiáº¿t:

```javascript
// KhÃ´ng Ä‘Æ°á»£c phÃ©p:
// âŒ Chá»n gháº¿ 2-9 (bá» trá»‘ng gháº¿ 1)
// âŒ Chá»n gháº¿ 1-8 (bá» trá»‘ng gháº¿ 9)
// âŒ Chá»n gháº¿ 1,2,4,5 (bá» trá»‘ng gháº¿ 3)

// ÄÆ°á»£c phÃ©p:
// âœ… Chá»n gháº¿ 1-5
// âœ… Chá»n gháº¿ 5-9
// âœ… Chá»n gháº¿ 1,2 vÃ  8,9 (bá» trá»‘ng 3-7 lÃ  OK vÃ¬ > 1 gháº¿)
```

**Logic validation:**

```javascript
const validateSeatRules = (selectedSeats) => {
  // Gom gháº¿ theo hÃ ng
  const map = {};
  selectedSeats.forEach(seat => {
    const row = seat[0];
    const num = parseInt(seat.slice(1));
    if (!map[row]) map[row] = [];
    map[row].push(num);
  });

  for (const row in map) {
    const nums = map[row].sort((a, b) => a - b);
    const min = nums[0];
    const max = nums[nums.length - 1];

    // Kiá»ƒm tra trá»‘ng 1 gháº¿ bÃªn trÃ¡i
    if (min > 1 && min - 1 === 1) {
      return {valid: false, message: "..."};
    }

    // Kiá»ƒm tra trá»‘ng 1 gháº¿ bÃªn pháº£i
    if (max < 9 && 9 - max === 1) {
      return {valid: false, message: "..."};
    }

    // Kiá»ƒm tra trá»‘ng 1 gháº¿ á»Ÿ giá»¯a
    for (let i = 0; i < nums.length - 1; i++) {
      if (nums[i + 1] - nums[i] === 2) {
        return {valid: false, message: "..."};
      }
    }
  }

  return {valid: true};
};
```

### 5. Xem lá»‹ch sá»­ Ä‘áº·t vÃ©

**Trang MyBookings (`/my-bookings`):**
- Hiá»ƒn thá»‹ táº¥t cáº£ bookings (cáº£ Ä‘Ã£ thanh toÃ¡n vÃ  chÆ°a)
- Booking chÆ°a thanh toÃ¡n: Hiá»ƒn thá»‹ nÃºt "Thanh toÃ¡n ngay" (link Ä‘áº¿n Stripe)
- ThÃ´ng tin: Phim, ngÃ y giá», gháº¿ ngá»“i, tá»•ng tiá»n

**API:** `GET /api/user/bookings`

```javascript
const bookings = await Booking.find({user: userId})
  .populate({
    path: 'show',
    populate: {path: 'movie'}
  })
  .sort({createdAt: -1});
```

---

## ğŸ‘¨â€ğŸ’¼ CHá»¨C NÄ‚NG ADMIN

### 1. Dashboard (`/admin/dashboard`)

**Thá»‘ng kÃª hiá»ƒn thá»‹:**
- ğŸ“Š Tá»•ng sá»‘ bookings (chá»‰ Ä‘áº¿m `ispaid: true`)
- ğŸ’° Tá»•ng doanh thu (`sum of booking.amount`)
- ğŸ¬ Sá»‘ shows Ä‘ang hoáº¡t Ä‘á»™ng (showDateTime >= now)
- ğŸ‘¥ Tá»•ng sá»‘ users

**API:** `GET /api/admin/dashboard`

### 2. ThÃªm suáº¥t chiáº¿u (`/admin/add-shows`)

**Quy trÃ¬nh:**

1. **Fetch phim tá»« TMDB**
   - API: `GET /api/show/now-playing`
   - Hiá»ƒn thá»‹ danh sÃ¡ch phim Ä‘ang chiáº¿u tá»« TMDB
   - Admin chá»n 1 phim

2. **Nháº­p thÃ´ng tin suáº¥t chiáº¿u**
   - GiÃ¡ vÃ© (showPrice)
   - Nhiá»u ngÃ y-giá» chiáº¿u (datetime-local input)
   - CÃ³ thá»ƒ thÃªm nhiá»u giá» chiáº¿u cho nhiá»u ngÃ y khÃ¡c nhau

3. **Submit**
   - API: `POST /api/show/add`
   - Backend:
     - Náº¿u phim chÆ°a cÃ³ trong DB â†’ Fetch tá»« TMDB (details + credits) â†’ Táº¡o Movie
     - Táº¡o nhiá»u Show records (má»—i date+time = 1 Show)
     - Trigger Inngest event `app/show.added` â†’ Gá»­i email cho táº¥t cáº£ users

**VÃ­ dá»¥ payload:**

```javascript
{
  movieId: "872585",
  showPrice: 12,
  showsInput: [
    {date: "2025-12-25", time: ["19:30", "22:00"]},
    {date: "2025-12-26", time: ["15:00", "18:00", "21:00"]}
  ]
}

// Sáº½ táº¡o 5 Show records:
// - 2025-12-25 19:30
// - 2025-12-25 22:00
// - 2025-12-26 15:00
// - 2025-12-26 18:00
// - 2025-12-26 21:00
```

### 3. Danh sÃ¡ch suáº¥t chiáº¿u (`/admin/list-shows`)

**Hiá»ƒn thá»‹:**
- Báº£ng táº¥t cáº£ shows sáº¯p tá»›i
- Cá»™t: TÃªn phim, Thá»i gian chiáº¿u, Sá»‘ gháº¿ Ä‘Ã£ Ä‘áº·t, Doanh thu (Æ°á»›c tÃ­nh)

**API:** `GET /api/admin/all-shows`

### 4. Danh sÃ¡ch bookings (`/admin/list-bookings`)

**Hiá»ƒn thá»‹:**
- Báº£ng táº¥t cáº£ bookings (cáº£ paid vÃ  unpaid)
- Cá»™t: User, Phim, Thá»i gian, Gháº¿, Sá»‘ tiá»n, Tráº¡ng thÃ¡i

**API:** `GET /api/admin/all-bookings`

---

## ğŸ’³ QUY TRÃŒNH THANH TOÃN STRIPE

### Flow chi tiáº¿t:

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant B as Backend
    participant DB as MongoDB
    participant S as Stripe
    participant I as Inngest

    U->>F: Chá»n gháº¿ + Click "Thanh toÃ¡n"
    F->>B: POST /api/booking/create
    
    B->>DB: Kiá»ƒm tra gháº¿ cÃ²n trá»‘ng?
    alt Gháº¿ Ä‘Ã£ bá»‹ Ä‘áº·t
        B->>F: Error: Gháº¿ Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t
        F->>U: Toast error
    else Gháº¿ cÃ²n trá»‘ng
        B->>DB: Táº¡o Booking (ispaid: false)
        B->>DB: Chiáº¿m gháº¿ (update occupiedSeats)
        B->>S: Táº¡o Checkout Session (expires: 30 phÃºt)
        S->>B: Return session.url
        B->>I: Trigger event "app/checkpayment"
        B->>F: Return {url: session.url}
        F->>U: Redirect sang Stripe
        
        Note over I: Äá»£i 10 phÃºt
        I->>DB: Kiá»ƒm tra booking.ispaid
        alt ChÆ°a thanh toÃ¡n
            I->>DB: XÃ³a booking + giáº£i phÃ³ng gháº¿
        end
        
        U->>S: Thanh toÃ¡n trÃªn Stripe
        S->>B: Webhook: payment_intent.succeeded
        B->>DB: Update booking (ispaid: true)
        B->>I: Trigger event "app/show.booked"
        I->>U: Gá»­i email xÃ¡c nháº­n
        S->>U: Redirect vá» success_url
    end
```

### Chi tiáº¿t tá»«ng bÆ°á»›c:

#### 1. Táº¡o Booking

```javascript
// POST /api/booking/create
const booking = await Booking.create({
  user: userId,
  show: showId,
  amount: showPrice * selectedSeats.length,
  bookedSeats: selectedSeats,
  ispaid: false
});

// Chiáº¿m gháº¿
selectedSeats.forEach(seat => {
  showData.occupiedSeats[seat] = userId;
});
showData.markModified('occupiedSeats');
await showData.save();
```

#### 2. Táº¡o Stripe Checkout Session

```javascript
const session = await stripe.checkout.sessions.create({
  success_url: `${origin}/loading/my-bookings`,
  cancel_url: `${origin}/my-bookings`,
  line_items: [{
    price_data: {
      currency: 'usd',
      product_data: {name: movieTitle},
      unit_amount: Math.floor(amount) * 100
    },
    quantity: 1
  }],
  mode: 'payment',
  metadata: {bookingId: booking._id.toString()},
  expires_at: Math.floor(Date.now() / 1000) + 30 * 60  // 30 phÃºt
});

booking.paymentLink = session.url;
await booking.save();
```

#### 3. Trigger Inngest Check Payment

```javascript
await inngest.send({
  name: "app/checkpayment",
  data: {bookingId: booking._id.toString()}
});
```

#### 4. Stripe Webhook Handler

```javascript
// POST /api/stripe
const event = stripe.webhooks.constructEvent(
  req.body,
  signature,
  webhookSecret
);

if (event.type === 'payment_intent.succeeded') {
  const bookingId = session.metadata.bookingId;
  await Booking.findByIdAndUpdate(bookingId, {
    ispaid: true,
    paymentLink: ""
  });
  
  await inngest.send({
    name: "app/show.booked",
    data: {bookingId}
  });
}
```

---

## ğŸ”„ BACKGROUND JOBS (INNGEST)

### 1. Äá»“ng bá»™ User tá»« Clerk

**3 Functions:**

```javascript
// sync-user-from-clerk
{event: 'clerk/user.created'}
â†’ Táº¡o User má»›i trong MongoDB

// update-user-from-clerk
{event: 'clerk/user.updated'}
â†’ Cáº­p nháº­t User trong MongoDB

// delete-user-with-clerk
{event: 'clerk/user.deleted'}
â†’ XÃ³a User khá»i MongoDB
```

### 2. Tá»± Ä‘á»™ng há»§y booking chÆ°a thanh toÃ¡n

**Function:** `release-seats-delete-booking`

**Trigger:** Event `app/checkpayment`

**Flow:**

```javascript
async ({ event, step }) => {
  // Äá»£i 10 phÃºt
  const tenMinutesLater = new Date(Date.now() + 10 * 60 * 1000);
  await step.sleepUntil('wait-for-10-minutes', tenMinutesLater);

  // Kiá»ƒm tra tráº¡ng thÃ¡i
  await step.run("check-payment-status", async () => {
    const booking = await Booking.findById(bookingId);
    
    if (!booking.ispaid) {
      // Giáº£i phÃ³ng gháº¿
      const show = await Show.findById(booking.show);
      booking.bookedSeats.forEach(seat => {
        delete show.occupiedSeats[seat];
      });
      show.markModified('occupiedSeats');
      await show.save();
      
      // XÃ³a booking
      await Booking.findByIdAndDelete(booking._id);
    }
  });
}
```

**Má»¥c Ä‘Ã­ch:** TrÃ¡nh trÆ°á»ng há»£p user chá»n gháº¿ nhÆ°ng khÃ´ng thanh toÃ¡n, khiáº¿n gháº¿ bá»‹ "Ä‘Ã³ng bÄƒng" mÃ£i mÃ£i.

### 3. Gá»­i email xÃ¡c nháº­n Ä‘áº·t vÃ©

**Function:** `send-booking-confirmation-email`

**Trigger:** Event `app/show.booked` (sau khi thanh toÃ¡n thÃ nh cÃ´ng)

**Ná»™i dung email:**
- ChÃ o tÃªn user
- TÃªn phim
- NgÃ y giá» chiáº¿u (format VN)
- Lá»i cáº£m Æ¡n

### 4. Gá»­i email nháº¯c nhá»Ÿ trÆ°á»›c khi chiáº¿u

**Function:** `send-show-reminders`

**Trigger:** Cron job `0 */8 * * *` (cháº¡y má»—i 8 giá»)

**Flow:**
1. TÃ¬m cÃ¡c shows sáº½ chiáº¿u trong 8 giá» tá»›i
2. Tá»« `occupiedSeats`, láº¥y danh sÃ¡ch userIds
3. Gá»­i email nháº¯c nhá»Ÿ cho tá»«ng user

**âš ï¸ LÆ°u Ã½:** Code hiá»‡n táº¡i cÃ³ bug (dÃ¹ng `showTime` thay vÃ¬ `showDateTime`)

### 5. Gá»­i thÃ´ng bÃ¡o phim má»›i

**Function:** `send-new-show-notifications`

**Trigger:** Event `app/show.added` (khi admin thÃªm show má»›i)

**Flow:**
1. Láº¥y táº¥t cáº£ users tá»« DB
2. Gá»­i email thÃ´ng bÃ¡o phim má»›i cho má»—i user

---

## ğŸ“Š KIáº¾N TRÃšC Há»† THá»NG

```mermaid
graph TB
    subgraph Client [Frontend - React]
        Home[Trang chá»§]
        Movies[Danh sÃ¡ch phim]
        Details[Chi tiáº¿t phim]
        Seats[Chá»n gháº¿]
        MyBookings[Bookings cá»§a tÃ´i]
        Admin[Admin Panel]
    end

    subgraph Backend [Backend - Express]
        API[API Routes]
        Controllers[Controllers]
        Models[Mongoose Models]
    end

    subgraph External [External Services]
        Clerk[Clerk Auth]
        TMDB[TMDB API]
        Stripe[Stripe Payment]
        Inngest[Inngest Jobs]
        Brevo[Brevo Email]
    end

    subgraph Database [MongoDB]
        UserDB[(Users)]
        MovieDB[(Movies)]
        ShowDB[(Shows)]
        BookingDB[(Bookings)]
    end

    Client -->|HTTP Requests| API
    API --> Controllers
    Controllers --> Models
    Models --> Database

    Controllers --> Clerk
    Controllers --> TMDB
    Controllers --> Stripe
    Controllers --> Inngest
    Inngest --> Brevo

    Clerk -->|Webhooks| Inngest
    Stripe -->|Webhooks| API
```

---

## ğŸ¯ CÃC ÄIá»‚M Äáº¶C BIá»†T

### 1. RÃ ng buá»™c gháº¿ ngá»“i

**Quy táº¯c:** KhÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng Ä‘Ãºng 1 gháº¿ Ä‘Æ¡n láº»

**LÃ½ do:** Trong thá»±c táº¿ ráº¡p phim, viá»‡c Ä‘á»ƒ trá»‘ng 1 gháº¿ giá»¯a 2 ngÆ°á»i/nhÃ³m ngÆ°á»i lÃ  khÃ´ng tá»‘i Æ°u, vÃ¬ khÃ³ bÃ¡n gháº¿ Ä‘Ã³ cho ai.

**Implementation:**
- Kiá»ƒm tra client-side trÆ°á»›c khi gá»i API (UX tá»‘t hÆ¡n)
- Validation logic trong `SeatLayout.jsx`

### 2. Giá»›i háº¡n sá»‘ gháº¿

**Quy táº¯c:** Má»—i booking tá»‘i Ä‘a 5 gháº¿

**MÃ£ nguá»“n:**

```javascript
if (!selectedSeats.includes(seatId) && selectedSeats.length > 4) {
  return toast("Báº¡n cÃ³ thá»ƒ chá»n 5 gháº¿ ngá»“i")
}
```

### 3. Timeout Stripe Checkout

**Thá»i gian:** 30 phÃºt

```javascript
expires_at: Math.floor(Date.now() / 1000) + 30 * 60
```

**LÃ½ do:** 
- TrÃ¡nh giá»¯ session quÃ¡ lÃ¢u
- Phá»‘i há»£p vá»›i Inngest (check sau 10 phÃºt, cÃ²n 20 phÃºt Ä‘á»ƒ hoÃ n táº¥t)

### 4. Auto-release gháº¿ sau 10 phÃºt

**Quy trÃ¬nh:**
1. Booking táº¡o lÃºc 14:00
2. Inngest trigger `app/checkpayment`
3. Äá»£i Ä‘áº¿n 14:10
4. Kiá»ƒm tra `ispaid`
5. Náº¿u váº«n `false` â†’ XÃ³a booking + giáº£i phÃ³ng gháº¿

**Äáº£m báº£o:**
- Gháº¿ khÃ´ng bá»‹ "Ä‘Ã³ng bÄƒng" vÃ´ thá»i háº¡n
- User khÃ¡c cÃ³ thá»ƒ Ä‘áº·t gháº¿ Ä‘Ã³
- Váº«n cÃ³ Ä‘á»§ thá»i gian thanh toÃ¡n (10 phÃºt + 20 phÃºt cÃ²n láº¡i cá»§a Stripe)

### 5. SÆ¡ Ä‘á»“ gháº¿ cá»‘ Ä‘á»‹nh

**Äáº·c Ä‘iá»ƒm:**
- Táº¥t cáº£ suáº¥t chiáº¿u dÃ¹ng chung 1 layout
- KhÃ´ng cÃ³ tÃ­nh nÄƒng thay Ä‘á»•i sÆ¡ Ä‘á»“ gháº¿
- KhÃ´ng cÃ³ phÃ¢n loáº¡i gháº¿ (VIP, thÆ°á»ng, Ä‘Ã´i, v.v.)
- Táº¥t cáº£ gháº¿ Ä‘á»u cÃ³ cÃ¹ng giÃ¡ (theo `showPrice`)

**Æ¯u Ä‘iá»ƒm:**
- ÄÆ¡n giáº£n, dá»… quáº£n lÃ½
- PhÃ¹ há»£p vá»›i mÃ´ hÃ¬nh ráº¡p nhá»/demo

**Háº¡n cháº¿:**
- KhÃ´ng linh hoáº¡t
- KhÃ´ng pháº£n Ã¡nh thá»±c táº¿ ráº¡p phim (cÃ³ nhiá»u phÃ²ng, nhiá»u loáº¡i gháº¿)

### 6. Má»™t phÃ²ng chiáº¿u duy nháº¥t

**áº¢nh hÆ°á»Ÿng:**
- KhÃ´ng thá»ƒ chiáº¿u Ä‘á»“ng thá»i 2 phim khÃ¡c nhau
- Náº¿u cÃ³ 2 shows cÃ¹ng giá» â†’ Conflict (code khÃ´ng kiá»ƒm tra)
- Admin pháº£i tá»± Ä‘áº£m báº£o khÃ´ng trÃ¹ng lá»‹ch

**Cáº£i thiá»‡n cÃ³ thá»ƒ lÃ m:**
- ThÃªm trÆ°á»ng `room` hoáº·c `theater` vÃ o Show model
- Kiá»ƒm tra conflict khi admin thÃªm show
- UI cho phÃ©p chá»n phÃ²ng chiáº¿u khi Ä‘áº·t vÃ©

---

## ğŸ”’ Báº¢O Máº¬T VÃ€ PHÃ‚N QUYá»€N

### Authentication

**Clerk JWT Token:**

```javascript
// Frontend
const token = await getToken();

// Backend
const {userId} = req.auth();  // Clerk Express middleware
```

### Authorization

**Admin Routes:**

```javascript
// middleware/auth.js
export const protectAdmin = async (req, res, next) => {
  const user = await clerkClient.users.getUser(req.auth().userId);
  if (user.privateMetadata.role !== 'admin') {
    return res.status(403).json({message: 'Access denied'});
  }
  next();
};

// routes/adminRoutes.js
router.get('/dashboard', protectAdmin, getDashboardData);
```

**Frontend Protection:**

```javascript
// Tá»± Ä‘á»™ng redirect náº¿u khÃ´ng pháº£i admin
useEffect(() => {
  if (user && user.publicMetadata.role !== 'admin') {
    navigate('/');
  }
}, [user]);
```

---

## ğŸ“ BUG VÃ€ Cáº¢I THIá»†N

### Bugs hiá»‡n táº¡i:

1. **Function `sendShowReminders`:**
   - âŒ Sá»­ dá»¥ng biáº¿n `windowStart` chÆ°a Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a
   - âŒ Field `showTime` khÃ´ng tá»“n táº¡i (nÃªn dÃ¹ng `showDateTime`)
   
   **Fix:**
   ```javascript
   const shows = await Show.find({
     showDateTime: {$gte: now, $lt: in8Hours}  // Sá»­a tá»« showTime
   }).populate('movie');
   ```

2. **MyBookings component:**
   - âŒ Typo: `item.bookedSeats.lenght` â†’ nÃªn lÃ  `length`

### Äiá»ƒm cáº§n cáº£i thiá»‡n:

1. **Kiá»ƒm tra conflict lá»‹ch chiáº¿u**
   - Hiá»‡n táº¡i khÃ´ng kiá»ƒm tra 2 shows cÃ¹ng giá»
   - NÃªn thÃªm validation khi admin thÃªm show

2. **Rate limiting**
   - CÃ¡c API public chÆ°a cÃ³ rate limit
   - CÃ³ thá»ƒ bá»‹ spam/DDoS

3. **Error handling**
   - Nhiá»u chá»— chá»‰ `console.log(error)` rá»“i tráº£ generic message
   - NÃªn cÃ³ error codes cá»¥ thá»ƒ

4. **Validation**
   - Input validation cÃ²n thiáº¿u á»Ÿ nhiá»u endpoint
   - NÃªn dÃ¹ng library nhÆ° Joi hoáº·c Zod

5. **Testing**
   - ChÆ°a cÃ³ unit tests
   - ChÆ°a cÃ³ integration tests

6. **Logging & Monitoring**
   - ChÆ°a cÃ³ structured logging
   - ChÆ°a cÃ³ monitoring/alerting

---

## ğŸš€ FLOW Tá»”NG THá»‚ Cá»¦A Há»† THá»NG

### Flow Ä‘áº·t vÃ© hoÃ n chá»‰nh:

```mermaid
flowchart TD
    Start([User vÃ o trang chá»§]) --> Browse[Xem danh sÃ¡ch phim]
    Browse --> SelectMovie[Chá»n phim quan tÃ¢m]
    SelectMovie --> ViewDetails[Xem chi tiáº¿t phim]
    ViewDetails --> SelectDate[Chá»n ngÃ y chiáº¿u]
    SelectDate --> SelectTime[Chá»n giá» chiáº¿u]
    SelectTime --> SeatPage[Chuyá»ƒn Ä‘áº¿n trang chá»n gháº¿]
    SeatPage --> LoadSeats[Load gháº¿ Ä‘Ã£ Ä‘áº·t tá»« API]
    LoadSeats --> ChooseSeats[Chá»n gháº¿ muá»‘n Ä‘áº·t]
    ChooseSeats --> Validate{Kiá»ƒm tra rÃ ng buá»™c gháº¿}
    Validate -->|Invalid| ShowError[Hiá»ƒn thá»‹ lá»—i]
    ShowError --> ChooseSeats
    Validate -->|Valid| CreateBooking[Gá»i API táº¡o booking]
    CreateBooking --> CheckAvailable{Gháº¿ cÃ²n trá»‘ng?}
    CheckAvailable -->|ÄÃ£ bá»‹ Ä‘áº·t| BookingError[BÃ¡o lá»—i gháº¿ Ä‘Ã£ Ä‘áº·t]
    BookingError --> End1([Káº¿t thÃºc])
    CheckAvailable -->|CÃ²n trá»‘ng| SaveBooking[LÆ°u booking vÃ o DB]
    SaveBooking --> OccupySeats[Chiáº¿m giá»¯ gháº¿ trong Show]
    OccupySeats --> CreateStripe[Táº¡o Stripe Checkout]
    CreateStripe --> TriggerCheck[Trigger Inngest checkpayment]
    TriggerCheck --> RedirectStripe[Redirect sang Stripe]
    RedirectStripe --> UserPay{User thanh toÃ¡n?}
    UserPay -->|KhÃ´ng/Cancel| Wait10min[Äá»£i 10 phÃºt]
    Wait10min --> ReleaseSeats[Inngest xÃ³a booking + giáº£i phÃ³ng gháº¿]
    ReleaseSeats --> End2([Káº¿t thÃºc])
    UserPay -->|CÃ³| StripeWebhook[Stripe gá»­i webhook]
    StripeWebhook --> UpdatePaid[Update booking: ispaid=true]
    UpdatePaid --> TriggerEmail[Trigger Inngest send email]
    TriggerEmail --> SendConfirm[Gá»­i email xÃ¡c nháº­n]
    SendConfirm --> RedirectSuccess[Redirect vá» My Bookings]
    RedirectSuccess --> End3([HoÃ n thÃ nh])
```

### Flow thÃªm suáº¥t chiáº¿u (Admin):

```mermaid
flowchart TD
    Start([Admin vÃ o Add Shows]) --> FetchTMDB[Fetch phim tá»« TMDB]
    FetchTMDB --> DisplayMovies[Hiá»ƒn thá»‹ danh sÃ¡ch phim]
    DisplayMovies --> SelectMovie[Admin chá»n phim]
    SelectMovie --> InputPrice[Nháº­p giÃ¡ vÃ©]
    InputPrice --> InputDateTime[ThÃªm ngÃ y-giá» chiáº¿u]
    InputDateTime --> MoreDateTime{ThÃªm ná»¯a?}
    MoreDateTime -->|CÃ³| InputDateTime
    MoreDateTime -->|KhÃ´ng| Submit[Submit form]
    Submit --> CheckMovieDB{Phim cÃ³ trong DB?}
    CheckMovieDB -->|KhÃ´ng| FetchDetails[Fetch details tá»« TMDB]
    FetchDetails --> SaveMovie[LÆ°u Movie vÃ o DB]
    SaveMovie --> CreateShows[Táº¡o cÃ¡c Show records]
    CheckMovieDB -->|CÃ³| CreateShows
    CreateShows --> TriggerNotif[Trigger Inngest show.added]
    TriggerNotif --> GetAllUsers[Láº¥y táº¥t cáº£ users]
    GetAllUsers --> SendEmails[Gá»­i email thÃ´ng bÃ¡o phim má»›i]
    SendEmails --> Success[Hiá»ƒn thá»‹ thÃ´ng bÃ¡o thÃ nh cÃ´ng]
    Success --> End([Káº¿t thÃºc])
```

---

## ğŸ“– TÃ“M Táº®T

### Äáº·c Ä‘iá»ƒm chÃ­nh cá»§a mÃ´ hÃ¬nh:

âœ… **1 phÃ²ng chiáº¿u duy nháº¥t** - Táº¥t cáº£ shows dÃ¹ng chung sÆ¡ Ä‘á»“ gháº¿  
âœ… **90 gháº¿ cá»‘ Ä‘á»‹nh** - 10 hÃ ng x 9 gháº¿  
âœ… **RÃ ng buá»™c Ä‘áº·t gháº¿** - KhÃ´ng Ä‘á»ƒ trá»‘ng 1 gháº¿ Ä‘Æ¡n  
âœ… **Tá»‘i Ä‘a 5 gháº¿/booking** - Giá»›i háº¡n sá»‘ lÆ°á»£ng  
âœ… **Tá»± Ä‘á»™ng há»§y** - Booking chÆ°a thanh toÃ¡n sau 10 phÃºt  
âœ… **Stripe Checkout** - 30 phÃºt timeout  
âœ… **Background jobs** - Inngest xá»­ lÃ½ email vÃ  cleanup  
âœ… **TMDB integration** - ThÃ´ng tin phim realtime  

### CÃ´ng nghá»‡:

- **Frontend:** React + Vite + Tailwind CSS
- **Backend:** Node.js + Express + MongoDB
- **Auth:** Clerk (JWT)
- **Payment:** Stripe
- **Jobs:** Inngest
- **Email:** Brevo
- **API:** TMDB

---

## ğŸ“ Káº¾T LUáº¬N

### Tá»•ng káº¿t dá»± Ã¡n

Há»‡ thá»‘ng Ä‘áº·t vÃ© xem phim **QuickShow** lÃ  má»™t á»©ng dá»¥ng web fullstack hiá»‡n Ä‘áº¡i, Ä‘Æ°á»£c xÃ¢y dá»±ng vá»›i cÃ¡c cÃ´ng nghá»‡ tiÃªn tiáº¿n vÃ  tÃ­ch há»£p nhiá»u dá»‹ch vá»¥ bÃªn thá»© ba cháº¥t lÆ°á»£ng cao. Dá»± Ã¡n Ä‘Ã£ hoÃ n thÃ nh Ä‘áº§y Ä‘á»§ cÃ¡c chá»©c nÄƒng cá»‘t lÃµi cá»§a má»™t há»‡ thá»‘ng Ä‘áº·t vÃ© trá»±c tuyáº¿n, bao gá»“m:

âœ… **Quáº£n lÃ½ phim vÃ  suáº¥t chiáº¿u**  
âœ… **Äáº·t vÃ© vá»›i sÆ¡ Ä‘á»“ gháº¿ trá»±c quan**  
âœ… **Thanh toÃ¡n trá»±c tuyáº¿n an toÃ n**  
âœ… **Tá»± Ä‘á»™ng hÃ³a quy trÃ¬nh nghiá»‡p vá»¥**  
âœ… **Quáº£n trá»‹ táº­p trung cho admin**  

### Äáº·c Ä‘iá»ƒm ná»•i báº­t

Äiá»ƒm Ä‘áº·c biá»‡t cá»§a há»‡ thá»‘ng lÃ  **mÃ´ hÃ¬nh 1 phÃ²ng chiáº¿u duy nháº¥t** vá»›i **90 gháº¿ cá»‘ Ä‘á»‹nh** (10 hÃ ng x 9 gháº¿), phÃ¹ há»£p vá»›i cÃ¡c ráº¡p phim quy mÃ´ nhá» hoáº·c dá»± Ã¡n demo/prototype. Máº·c dÃ¹ cÃ³ giá»›i háº¡n vá» sá»‘ lÆ°á»£ng phÃ²ng chiáº¿u, há»‡ thá»‘ng váº«n Ä‘áº£m báº£o tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng mÆ°á»£t mÃ  vá»›i cÃ¡c tÃ­nh nÄƒng nhÆ°:

- RÃ ng buá»™c Ä‘áº·t gháº¿ thÃ´ng minh (khÃ´ng Ä‘á»ƒ trá»‘ng 1 gháº¿ Ä‘Æ¡n)
- Tá»± Ä‘á»™ng há»§y booking chÆ°a thanh toÃ¡n sau 10 phÃºt
- Gá»­i email xÃ¡c nháº­n vÃ  nháº¯c nhá»Ÿ tá»± Ä‘á»™ng
- Background jobs xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™

### Tiá»m nÄƒng phÃ¡t triá»ƒn

Vá»›i kiáº¿n trÃºc rÃµ rÃ ng, code clean vÃ  documentation Ä‘áº§y Ä‘á»§, há»‡ thá»‘ng cÃ³ thá»ƒ dá»… dÃ ng má»Ÿ rá»™ng thÃªm cÃ¡c tÃ­nh nÄƒng nhÆ°:

- ğŸ¬ Quáº£n lÃ½ nhiá»u phÃ²ng chiáº¿u/ráº¡p
- ğŸ« PhÃ¢n loáº¡i gháº¿ vÃ  giÃ¡ linh hoáº¡t
- ğŸ’° ChÆ°Æ¡ng trÃ¬nh khuyáº¿n mÃ£i
- ğŸ¿ Äáº·t combo Ä‘á»“ Äƒn
- â­ Review vÃ  rating
- ğŸ“± Mobile application

### ÄÃ¡nh giÃ¡ chung

Vá»›i Ä‘iá»ƒm sá»‘ trung bÃ¬nh **8.4/10**, dá»± Ã¡n QuickShow lÃ  má»™t há»‡ thá»‘ng Ä‘áº·t vÃ© xem phim hoÃ n chá»‰nh, Ä‘Ã¡p á»©ng tá»‘t yÃªu cáº§u nghiá»‡p vá»¥ vÃ  ká»¹ thuáº­t. Há»‡ thá»‘ng sáºµn sÃ ng Ä‘á»ƒ triá»ƒn khai thÆ°Æ¡ng máº¡i cho cÃ¡c ráº¡p phim quy mÃ´ nhá» hoáº·c lÃ m ná»n táº£ng Ä‘á»ƒ phÃ¡t triá»ƒn thÃ nh há»‡ thá»‘ng lá»›n hÆ¡n.

---

**TÃ i liá»‡u nÃ y mÃ´ táº£ Ä‘áº§y Ä‘á»§ mÃ´ hÃ¬nh ráº¡p phim vÃ  cÃ¡c chá»©c nÄƒng nghiá»‡p vá»¥ cá»§a há»‡ thá»‘ng QuickShow.**

*PhiÃªn báº£n: 2.0 | NgÃ y cáº­p nháº­t: 23/12/2025*

---

## ğŸ“š PHá»¤ Lá»¤C

### A. Glossary (Thuáº­t ngá»¯)

| Thuáº­t ngá»¯ | Äá»‹nh nghÄ©a |
|-----------|------------|
| **Booking** | ÄÆ¡n Ä‘áº·t vÃ©, bao gá»“m thÃ´ng tin user, show, gháº¿ vÃ  tráº¡ng thÃ¡i thanh toÃ¡n |
| **Show** | Suáº¥t chiáº¿u - má»™t phim táº¡i má»™t thá»i gian cá»¥ thá»ƒ |
| **Occupied Seats** | Gháº¿ Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t, lÆ°u dáº¡ng object {seatId: userId} |
| **Payment Link** | URL Stripe Checkout Ä‘á»ƒ thanh toÃ¡n |
| **Admin** | Quáº£n trá»‹ viÃªn cÃ³ quyá»n quáº£n lÃ½ shows vÃ  bookings |
| **TMDB** | The Movie Database - API cung cáº¥p thÃ´ng tin phim |
| **Inngest** | Ná»n táº£ng xá»­ lÃ½ background jobs vÃ  event-driven workflows |
| **Clerk** | Dá»‹ch vá»¥ authentication vÃ  user management |
| **Stripe** | Ná»n táº£ng thanh toÃ¡n trá»±c tuyáº¿n |
| **Brevo** | Dá»‹ch vá»¥ gá»­i email (tÃªn cÅ©: Sendinblue) |

### B. Environment Variables

#### Backend (.env)

```bash
# Database
MONGO_URI=mongodb+srv://...

# Clerk
CLERK_PUBLISHABLE_KEY=pk_...
CLERK_SECRET_KEY=sk_...
CLERK_WEBHOOK_SECRET=whsec_...

# Stripe
STRIPE_SECRET_KEY=sk_...
STRIPE_WEBHOOK_SECRET=whsec_...

# Inngest
INNGEST_SIGNING_KEY=signkey-...
INNGEST_EVENT_KEY=...

# Brevo
BREVO_API_KEY=xkeysib-...
SENDER_EMAIL=noreply@example.com

# TMDB
TMDB_API_KEY=Bearer eyJ...

# Server
PORT=3000
```

#### Frontend (.env)

```bash
# API
VITE_BASE_URL=http://localhost:3000
# hoáº·c production: https://api.example.com

# TMDB
VITE_TMDB_IMAGE_BASE_URL=https://image.tmdb.org/t/p/original

# Clerk
VITE_CLERK_PUBLISHABLE_KEY=pk_...

# UI
VITE_CURRENCY=$
```

### C. API Endpoints Summary

#### Public Routes

```
GET  /api/show/all              - Láº¥y danh sÃ¡ch phim
GET  /api/show/:movieId         - Chi tiáº¿t phim + lá»‹ch chiáº¿u
GET  /api/booking/seats/:showId - Gháº¿ Ä‘Ã£ Ä‘áº·t cá»§a 1 show
```

#### Protected Routes (User)

```
POST /api/booking/create        - Táº¡o booking
GET  /api/user/bookings         - Lá»‹ch sá»­ booking
POST /api/user/update-favorite  - Toggle favorite
GET  /api/user/favorites        - Danh sÃ¡ch favorites
```

#### Admin Routes

```
GET  /api/admin/dashboard       - Dashboard data
GET  /api/show/now-playing      - Phim tá»« TMDB
POST /api/show/add              - ThÃªm shows
GET  /api/admin/all-shows       - Táº¥t cáº£ shows
GET  /api/admin/all-bookings    - Táº¥t cáº£ bookings
```

#### Webhook Routes

```
POST /api/stripe                - Stripe webhook
POST /api/inngest               - Inngest functions
```

### D. Contact & Support

**Dá»± Ã¡n:** QuickShow - Movie Ticket Booking System  
**Loáº¡i:** Luáº­n vÄƒn tá»‘t nghiá»‡p (LVTN)  
**NÄƒm:** 2025  

**Tech Stack:**
- Frontend: React + Vite + Tailwind CSS
- Backend: Node.js + Express + MongoDB
- Services: Clerk, Stripe, TMDB, Inngest, Brevo

**Documentation Files:**
- `MO_HINH_RAP_PHIM.md` - TÃ i liá»‡u nÃ y
- `NGHIEP_VU_CHUC_NANG.md` - TÃ i liá»‡u nghiá»‡p vá»¥ gá»‘c
- `README.md` - HÆ°á»›ng dáº«n setup

---

*Â© 2025 QuickShow. All rights reserved.*

